"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[568],{656:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(4848);r(6540);var a=r(1829);let n=e=>{let{items:t,onOpen:r,onDelete:n,openText:l="Open",deleteText:s="Delete",showOpen:o=!1,isOpenDisabled:d,workingText:c="Working..."}=e;return(0,i.jsx)("div",{className:"space-y-3",children:t.length>0?t.map((e,t)=>(0,i.jsxs)("div",{className:"bg-neutral-50 rounded-md p-4 flex items-center justify-between border border-border-primary",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium text-foreground-primary",children:e.label||"Attachment ".concat(t+1)}),(e.metaLeft||e.metaRight||e.typeName)&&(0,i.jsxs)("div",{className:"text-sm text-foreground-tertiary flex gap-4",children:[e.typeName?(0,i.jsx)("span",{children:e.typeName}):null,e.metaLeft?(0,i.jsx)("span",{children:e.metaLeft}):null,e.metaRight?(0,i.jsx)("span",{children:e.metaRight}):null]})]}),(o||e.showDelete)&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[o&&r&&(0,i.jsx)("button",{onClick:()=>r(e.id),disabled:!!d&&d(e),className:"bg-primary-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-60",children:d&&d(e)?c:"function"==typeof l?l(e):l}),e.showDelete&&n&&(0,i.jsx)("button",{onClick:()=>n(e.id),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 transition-colors",title:s,children:(0,i.jsx)(a.A,{className:"w-4 h-4"})})]})]},"".concat(e.id,"-").concat(t))):(0,i.jsx)("div",{className:"text-center py-8 text-foreground-tertiary",children:(0,i.jsx)("p",{className:"text-sm",children:"No attachments yet"})})})}},2349:(e,t,r)=>{r.d(t,{A:()=>p});var i=r(4848),a=r(6540),n=r(476),l=r(98),s=r(9868);let o=[{name:"PNG",extensions:[".png"]},{name:"JPG",extensions:[".jpg"]},{name:"JPEG",extensions:[".jpeg"]},{name:"DICOM",extensions:[".dcm",".dicom",".dic",".ima",".acr",".dc3"]},{name:"NIfTI-1 / NIfTI-2",extensions:[".nii",".nii.gz"]},{name:"Analyze 7.5",extensions:[".hdr",".img"]},{name:"Aperio SVS",extensions:[".svs"]},{name:"Zeiss CZI",extensions:[".czi"]},{name:"Zeiss LSM",extensions:[".lsm"]},{name:"EDF / EDF+",extensions:[".edf"]},{name:"WFDB (PhysioNet)",extensions:[".dat",".hea"]},{name:"PDF",extensions:[".pdf"]},{name:"Link",extensions:[".url"],patterns:[/^https?:\/\/.+/i,/^ftp:\/\/.+/i,/^sftp:\/\/.+/i,/^file:\/\/.+/i,/^mailto:.+/i,/^tel:.+/i,/^www\..+/i,/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}/i]}];function d(){let e=new Set([".nii.gz"]);for(let t of o)for(let r of t.extensions)e.add(r);return e.delete(".url"),Array.from(e).join(",")}function c(){return".png,.jpg,.jpeg,.svg"}var m=r(9785),u=r(5065);let p=e=>{let{isOpen:t,onClose:p,caseId:h,onUploaded:x,isDiagnosis:f=!1}=e,{t:v}=(0,l.o)(),[g,y]=(0,a.useState)("file"),[w,b]=(0,a.useState)(!1),[N,j]=(0,a.useState)(null),k=(0,a.useRef)(null),C=(0,a.useRef)(null),[P,L]=(0,a.useState)(""),[E,A]=(0,a.useState)(""),I=s.k.getInstance(),{register:D,getValues:F,reset:R,watch:S,formState:{errors:T}}=(0,m.mN)(),U=S("linkUrl"),q=S("description");(0,a.useEffect)(()=>{if(t){L(""),A(""),j(null);try{k.current&&(k.current.value=""),C.current&&(C.current.value="")}catch(e){}R({linkUrl:"",description:""})}},[t,R]);let z=e=>{try{if(/^(mailto:|tel:)/i.test(e)||/^www\./i.test(e))return!0;return!!new URL(/^https?:\/\//i.test(e)?e:"https://".concat(e)).hostname}catch(e){return!1}},W=async e=>{let t=function(e){if(!e)return null;let t=e.toLowerCase();if(t.endsWith(".nii.gz"))return"NIfTI-1 / NIfTI-2";for(let e of o)for(let r of e.extensions)if(t.endsWith(r))return e.name;let r=t.startsWith(".")?t:".".concat(t);for(let e of o)if(e.extensions.includes(r))return e.name;for(let t of o)if(t.patterns&&t.patterns.some(t=>t.test(e)))return t.name;return null}(e.name),r=await I.createAttachment({caseId:h,originalName:e.name,type:t?{name:t}:null,is_diagnosis:f}),i=null==r?void 0:r.url,a=null==r?void 0:r.attachmentId;if(!i)throw Error("Upload URL not returned");let n=new URL(String(i)).searchParams.get("Content-Type")||void 0,l=await fetch(i,{method:"PUT",headers:n?{"Content-Type":n}:e.type?{"Content-Type":e.type}:{},body:e});if(!l.ok){let e=await l.text();try{a&&"number"==typeof h&&await I.deleteAttachment({attachmentId:String(a),caseId:h})}catch(e){}throw Error(e||"Failed to upload to storage")}if(a){let r="number"==typeof a?a:Number(a);Number.isNaN(r)||null==x||x(r,e.name,t||void 0)}},G=async(e,t)=>{let r=await I.createAttachment({caseId:h,url:e,description:t,type:{name:"Link"},is_diagnosis:f});r&&"number"==typeof r.attachmentId&&(null==x||x(r.attachmentId,t||e,"Link"))},Q=async e=>{let t=(await r.e(242).then(r.t.bind(r,6624,23))).default,i=async e=>{var r,i,a,n;let l=null!==(i=null!==(r=e.width)&&void 0!==r?r:e.width)&&void 0!==i?i:0,s=null!==(n=null!==(a=e.height)&&void 0!==a?a:e.height)&&void 0!==n?n:0,o=document.createElement("canvas");o.width=l,o.height=s;let d=o.getContext("2d");if(!d)return null;d.drawImage(e,0,0);let c=d.getImageData(0,0,o.width,o.height),m=t(c.data,c.width,c.height);return(null==m?void 0:m.data)||null};if(/\.svg$/i.test(e.name)||"image/svg+xml"===e.type){let t=await new Promise((t,r)=>{let i=new FileReader;i.onload=()=>t(String(i.result)),i.onerror=r,i.readAsDataURL(e)});return i(await new Promise((e,r)=>{let i=new Image;i.onload=()=>e(i),i.onerror=r,i.src=t}))}return i(await createImageBitmap(e))},Z=async()=>{try{var e,t,r,i;if(j(null),b(!0),"file"===g){let r=null===(t=k.current)||void 0===t?void 0:null===(e=t.files)||void 0===e?void 0:e[0];if(!r)throw Error("Please select a file");await W(r)}else if("link"===g){let e=(F("linkUrl")||"").trim();if(!z(e))throw Error("Please enter a valid link");let t=(F("description")||"").trim();if(!t)throw Error("Please enter a description");let r=/^(https?:\/\/|mailto:|tel:)/i.test(e)?e:(e.startsWith("www."),"https://".concat(e));await G(r,t)}else if("qr"===g){let e=null===(i=C.current)||void 0===i?void 0:null===(r=i.files)||void 0===r?void 0:r[0];if(!e)throw Error("Please select an image or PDF with QR");if(/\.pdf$/i.test(e.name))throw Error("QR decoding from PDF is not supported in-browser. Please upload an image containing the QR code.");let t=await Q(e);if(!t)throw Error("Could not read a QR code from the image");if(!z(t))throw Error("QR code does not contain a valid link");let a=(F("description")||"").trim();if(!a)throw Error("Please enter a description");let n=/^(https?:\/\/|mailto:|tel:)/i.test(t)?t:(t.startsWith("www."),"https://".concat(t));await G(n,a)}p()}finally{b(!1)}},J=d().split(","),_=c().split(","),M=(e,t)=>{let r=e.toLowerCase();return t.some(e=>r.endsWith(e))},O=()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},H=()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},B=e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if(!M(r.name,J)){L(""),e.currentTarget.value="",j(v("validation.fileTypeNotAllowed")||"This file type is not allowed");return}j(null),L(r.name)}},$=e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if(!M(r.name,_)){A(""),e.currentTarget.value="",j(v("validation.fileTypeNotAllowed")||"This file type is not allowed");return}if(/\.pdf$/i.test(r.name)){A(""),e.currentTarget.value="",j(v("case.details.qrPdfNotSupported")||"QR decoding from PDF is not supported");return}j(null),A(r.name)}},V="file"===g?!!P:"link"===g?!!(null==q?void 0:q.trim())&&!!U&&z(U):!!E&&!!(null==q?void 0:q.trim());return(0,i.jsxs)(n.A,{isOpen:t,onClose:p,title:v("case.details.upload")||"Upload",size:"lg",children:[(0,i.jsx)("div",{className:"px-6 pt-4",children:(0,i.jsx)("div",{className:"inline-flex rounded-md border border-border-primary overflow-hidden w-full",children:["file","link","qr"].map(e=>(0,i.jsx)("button",{className:"px-4 py-2 text-sm w-full ".concat(g===e?"bg-primary-600 text-white":"bg-background-secondary text-foreground-primary"),onClick:()=>y(e),disabled:w,children:"file"===e?v("case.details.modeFile")||"File":"link"===e?v("case.details.modeLink")||"Link":v("case.details.modeQr")||"QR"},e))})}),(()=>{var e,t,r;return"file"===g?(0,i.jsxs)("div",{className:"p-6 space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-secondary",children:v("case.details.uploadFileHint")||"Upload PNG, JPG, JPEG, PDF, DICOM, NIfTI, etc."}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("input",{ref:k,type:"file",accept:d(),className:"hidden",onChange:B}),(0,i.jsx)("button",{type:"button",onClick:O,className:"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700",children:v("common.chooseFile")||"Choose file"}),(0,i.jsx)("span",{className:"text-sm text-foreground-secondary",children:P?"".concat(v("common.selectedFile")||"Selected",": ").concat(P):v("common.noFileChosen")||"No file chosen"})]})]}):"link"===g?(0,i.jsxs)("div",{className:"p-6 space-y-4",children:[(0,i.jsx)(u.l,{label:v("case.details.modeLink")||"Link",name:"linkUrl",register:D,type:"url",validation:{required:"Link is required",validate:e=>z(e)||"Please enter a valid link"},error:null===(t=T.linkUrl)||void 0===t?void 0:t.message}),(0,i.jsx)("p",{className:"text-xs text-foreground-tertiary",children:v("case.details.linkHint")||"Accepts http(s), mailto:, tel:, or domain names. Will be validated."}),(0,i.jsx)(u.l,{label:"Description",name:"description",register:D,required:!0,validation:{required:"Description is required",maxLength:{value:256,message:"Max 256 characters"}},error:null===(r=T.description)||void 0===r?void 0:r.message})]}):(0,i.jsxs)("div",{className:"p-6 space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-secondary",children:v("case.details.qrHint")||"Upload an image (PNG/JPG/JPEG/SVG) containing a QR code. We will read it and store the link."}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("input",{ref:C,type:"file",accept:c(),className:"hidden",onChange:$}),(0,i.jsx)("button",{type:"button",onClick:H,className:"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700",children:v("common.chooseFile")||"Choose file"}),(0,i.jsx)("span",{className:"text-sm text-foreground-secondary",children:E?"".concat(v("common.selectedFile")||"Selected",": ").concat(E):v("common.noFileChosen")||"No file chosen"})]}),(0,i.jsx)(u.l,{label:"Description",name:"description",register:D,required:!0,validation:{required:"Description is required",maxLength:{value:256,message:"Max 256 characters"}},error:null===(e=T.description)||void 0===e?void 0:e.message})]})})(),N&&(0,i.jsx)("div",{className:"px-6 pb-2 text-sm text-red-600",children:N}),(0,i.jsxs)("div",{className:"px-6 pb-6 flex justify-end gap-3",children:[(0,i.jsx)("button",{onClick:p,className:"px-4 py-2 rounded-md border border-border-primary",children:v("common.cancel")||"Cancel"}),(0,i.jsx)("button",{onClick:Z,disabled:w||!V,className:"px-4 py-2 rounded-md bg-primary-600 text-white disabled:opacity-60",children:w?v("common.working")||"Working...":v("common.submit")||"Submit"})]})]})}},1028:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4848);r(6540);let a=e=>{let{marginClass:t="my-3",colorVar:r="var(--border-secondary)",className:a=""}=e;return(0,i.jsx)("div",{className:"".concat(t," flex justify-center ").concat(a),children:(0,i.jsx)("div",{className:"h-[1px] w-full",style:{backgroundColor:r}})})}},5065:(e,t,r)=>{r.d(t,{l:()=>n});var i=r(4848),a=r(6246);let n=e=>{let{label:t,name:r,register:n,error:l,required:s=!1,tooltip:o,validation:d={},className:c="",type:m="text",placeholder:u}=e;return(0,i.jsxs)("div",{className:"mb-4 ".concat(c),children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsxs)("label",{className:"block text-base font-medium text-heading mb-2",children:[t,s&&(0,i.jsx)("span",{className:"text-error-500 ml-1",children:"*"})]}),o&&(0,i.jsxs)("div",{className:"relative group",children:[(0,i.jsx)("span",{className:"cursor-help text-foreground-tertiary hover:text-foreground-secondary",children:(0,i.jsx)(a.A,{className:"w-4 h-4"})}),(0,i.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-neutral-900 text-white text-sm rounded p-2 bottom-full mb-1 w-48",children:o})]})]}),(0,i.jsx)("input",{type:m,placeholder:u,...n(r,d),className:"input-field"}),l&&(0,i.jsx)("p",{className:"mt-2 text-sm text-error-600",children:l})]})}},476:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(4848),a=r(6540),n=r(98),l=r(6802);let s=e=>{let{isOpen:t,onClose:r,title:s,children:o,size:d="lg"}=e,{t:c}=(0,n.o)();return((0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,r]),t)?(0,i.jsxs)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:r}),(0,i.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"relative bg-background-primary rounded-xl shadow-xl border border-border-primary w-full ".concat({sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-7xl",full:"max-w-7xl"}[d]," max-h-[90vh] overflow-hidden"),onClick:e=>e.stopPropagation(),children:[s&&(0,i.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-primary",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-foreground-primary",children:s}),(0,i.jsx)("button",{onClick:r,className:"text-foreground-tertiary hover:text-foreground-primary transition-colors duration-200 p-1 rounded-lg hover:bg-background-secondary","aria-label":c("common.close")||"Close",children:(0,i.jsx)(l.A,{className:"w-6 h-6"})})]}),(0,i.jsx)("div",{className:"overflow-y-auto max-h-[calc(90vh-120px)]",children:o})]})})]}):null}},1829:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(6540);let a=i.forwardRef(function(e,t){let{title:r,titleId:a,...n}=e;return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),r?i.createElement("title",{id:a},r):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))})}}]);
//# sourceMappingURL=568-893358aac0d57cdb.js.map