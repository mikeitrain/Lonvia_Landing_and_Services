{"version":3,"file":"static/chunks/568-893358aac0d57cdb.js","mappings":"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","sources":["webpack://_N_E/./src/components/attachment/AttachmentList.tsx","webpack://_N_E/./src/lib/attachmentTypeUtils.ts","webpack://_N_E/./src/components/case/UploadAttachmentWizard.tsx","webpack://_N_E/./src/components/common/Divider.tsx","webpack://_N_E/./src/components/common/FormInputField.tsx","webpack://_N_E/./src/components/common/Modal.tsx","webpack://_N_E/./node_modules/@heroicons/react/24/outline/esm/TrashIcon.js"],"sourcesContent":["import React from 'react';\nimport { TrashIcon } from '@heroicons/react/24/outline';\n\ninterface AttachmentListItem {\n  id: number | string;\n  label?: string;\n  metaLeft?: string;\n  metaRight?: string;\n  typeName?: string;\n  showDelete?: boolean;\n}\n\ninterface AttachmentListProps {\n  items: AttachmentListItem[];\n  onOpen?: (id: number | string) => void;\n  onDelete?: (id: number | string) => void;\n  openText?: string | ((item: AttachmentListItem) => string);\n  deleteText?: string;\n  showOpen?: boolean;\n  isOpenDisabled?: (item: AttachmentListItem) => boolean;\n  workingText?: string;\n}\n\nexport const AttachmentList: React.FC<AttachmentListProps> = ({ items, onOpen, onDelete, openText = 'Open', deleteText = 'Delete', showOpen = false, isOpenDisabled, workingText = 'Working...' }) => {\n  return (\n    <div className=\"space-y-3\">\n      {items.length > 0 ? (\n        items.map((item, index) => (\n          <div key={`${item.id}-${index}`} className=\"bg-neutral-50 rounded-md p-4 flex items-center justify-between border border-border-primary\">\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-foreground-primary\">\n                {item.label || `Attachment ${index + 1}`}\n              </div>\n              {(item.metaLeft || item.metaRight || item.typeName) && (\n                <div className=\"text-sm text-foreground-tertiary flex gap-4\">\n                  {item.typeName ? <span>{item.typeName}</span> : null}\n                  {item.metaLeft ? <span>{item.metaLeft}</span> : null}\n                  {item.metaRight ? <span>{item.metaRight}</span> : null}\n                </div>\n              )}\n            </div>\n            {(showOpen || item.showDelete) && (\n              <div className=\"flex items-center gap-2\">\n                {showOpen && onOpen && (\n                  <button onClick={() => onOpen(item.id)} disabled={isOpenDisabled ? isOpenDisabled(item) : false} className=\"bg-primary-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-60\">\n                    {isOpenDisabled && isOpenDisabled(item) ? workingText : (typeof openText === 'function' ? openText(item) : openText)}\n                  </button>\n                )}\n                {item.showDelete && onDelete && (\n                  <button onClick={() => onDelete(item.id)} className=\"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 transition-colors\" title={deleteText}>\n                    <TrashIcon className=\"w-4 h-4\" />\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        ))\n      ) : (\n        <div className=\"text-center py-8 text-foreground-tertiary\">\n          <p className=\"text-sm\">No attachments yet</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AttachmentList;\n\n\n","// Frontend helper to map filenames/URLs to backend attachment type names\n\nexport type AttachmentTypeName =\n  | 'PNG'\n  | 'JPG'\n  | 'JPEG'\n  | 'DICOM'\n  | 'NIfTI-1 / NIfTI-2'\n  | 'Analyze 7.5'\n  | 'Aperio SVS'\n  | 'Zeiss CZI'\n  | 'Zeiss LSM'\n  | 'EDF / EDF+'\n  | 'WFDB (PhysioNet)'\n  | 'PDF'\n  | 'Link';\n\ninterface AttachmentTypeSpec {\n  name: AttachmentTypeName;\n  extensions: string[]; // lowercased, include dot (e.g., .pdf)\n  patterns?: RegExp[]; // for matching URLs/links\n}\n\nconst ATTACHMENT_TYPES: AttachmentTypeSpec[] = [\n  { name: 'PNG', extensions: ['.png'] },\n  { name: 'JPG', extensions: ['.jpg'] },\n  { name: 'JPEG', extensions: ['.jpeg'] },\n  { name: 'DICOM', extensions: ['.dcm', '.dicom', '.dic', '.ima', '.acr', '.dc3'] },\n  { name: 'NIfTI-1 / NIfTI-2', extensions: ['.nii', '.nii.gz'] },\n  { name: 'Analyze 7.5', extensions: ['.hdr', '.img'] },\n  { name: 'Aperio SVS', extensions: ['.svs'] },\n  { name: 'Zeiss CZI', extensions: ['.czi'] },\n  { name: 'Zeiss LSM', extensions: ['.lsm'] },\n  { name: 'EDF / EDF+', extensions: ['.edf'] },\n  { name: 'WFDB (PhysioNet)', extensions: ['.dat', '.hea'] },\n  { name: 'PDF', extensions: ['.pdf'] },\n  {\n    name: 'Link',\n    extensions: ['.url'],\n    patterns: [\n      /^https?:\\/\\/.+/i,\n      /^ftp:\\/\\/.+/i,\n      /^sftp:\\/\\/.+/i,\n      /^file:\\/\\/.+/i,\n      /^mailto:.+/i,\n      /^tel:.+/i,\n      /^www\\..+/i,\n      /^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\\.[a-zA-Z]{2,}/i,\n    ],\n  },\n];\n\n/**\n * Returns the attachment type name for a given filename or URL, or null if unsupported.\n */\nexport function getAttachmentTypeNameForFilename(input: string): AttachmentTypeName | null {\n  if (!input) return null;\n  const lower = input.toLowerCase();\n\n  // Special-case multi-part extensions like .nii.gz first\n  if (lower.endsWith('.nii.gz')) return 'NIfTI-1 / NIfTI-2';\n\n  // Exact extension match (with dot)\n  for (const type of ATTACHMENT_TYPES) {\n    for (const ext of type.extensions) {\n      if (lower.endsWith(ext)) {\n        return type.name;\n      }\n    }\n  }\n\n  // If input is just the extension (with or without dot)\n  const normalizedExt = lower.startsWith('.') ? lower : `.${lower}`;\n  for (const type of ATTACHMENT_TYPES) {\n    if (type.extensions.includes(normalizedExt)) {\n      return type.name;\n    }\n  }\n\n  // Pattern-based matching (links)\n  for (const type of ATTACHMENT_TYPES) {\n    if (type.patterns && type.patterns.some((re) => re.test(input))) {\n      return type.name;\n    }\n  }\n\n  return null;\n}\n\n/** Returns true if the given filename looks like a supported file upload (non-link). */\nexport function isSupportedFileByExtension(filename: string): boolean {\n  const type = getAttachmentTypeNameForFilename(filename);\n  return type !== null && type !== 'Link';\n}\n\n/** Builds an accept attribute string for HTML file inputs from all supported extensions. */\nexport function buildAcceptStringForAllFiles(): string {\n  // Include multi-part .nii.gz explicitly\n  const unique = new Set<string>(['.nii.gz']);\n  for (const spec of ATTACHMENT_TYPES) {\n    for (const ext of spec.extensions) {\n      unique.add(ext);\n    }\n  }\n  // Exclude Link's .url\n  unique.delete('.url');\n  return Array.from(unique).join(',');\n}\n\n/** Minimal accept string for QR-image uploads. */\nexport function buildAcceptStringForQrImages(): string {\n  return ['.png', '.jpg', '.jpeg', '.svg'].join(',');\n}\n\nexport const AttachmentTypeSpecs = ATTACHMENT_TYPES;\n\n\n","import React, { useEffect, useRef, useState } from 'react';\nimport Modal from '@/components/common/Modal';\nimport { useLanguage } from '@/contexts/LanguageContext';\nimport { HttpService } from '@/services/httpService';\nimport { getAttachmentTypeNameForFilename, buildAcceptStringForAllFiles, buildAcceptStringForQrImages } from '@/lib/attachmentTypeUtils';\nimport { useForm, Path } from 'react-hook-form';\nimport { FormInputField } from '@/components/common/FormInputField';\n\ntype UploadMode = 'file' | 'link' | 'qr';\n\ninterface UploadAttachmentWizardProps {\n  isOpen: boolean;\n  onClose: () => void;\n  caseId?: number;\n  onUploaded?: (attachmentId?: number, displayName?: string, typeName?: string) => void;\n  isDiagnosis?: boolean;\n}\n\ntype LinkForm = { linkUrl: string; description: string };\n\nexport const UploadAttachmentWizard: React.FC<UploadAttachmentWizardProps> = ({ isOpen, onClose, caseId, onUploaded, isDiagnosis = false }) => {\n  const { t } = useLanguage();\n  const [mode, setMode] = useState<UploadMode>('file');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const qrInputRef = useRef<HTMLInputElement | null>(null);\n  const [selectedFileName, setSelectedFileName] = useState<string>('');\n  const [selectedQrFileName, setSelectedQrFileName] = useState<string>('');\n\n  const http = HttpService.getInstance();\n\n  const { register, getValues, reset, watch, formState: { errors } } = useForm<{ linkUrl: string; description: string }>();\n\n  const watchedLinkUrl = watch('linkUrl');\n  const watchedDescription = watch('description');\n\n  // Reset ephemeral state whenever the modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setSelectedFileName('');\n      setSelectedQrFileName('');\n      setError(null);\n      try {\n        if (fileInputRef.current) {\n          fileInputRef.current.value = '';\n        }\n        if (qrInputRef.current) {\n          qrInputRef.current.value = '';\n        }\n      } catch {}\n      reset({ linkUrl: '', description: '' });\n    }\n  }, [isOpen, reset]);\n\n  const validateUrl = (value: string) => {\n    try {\n      // Accepts http(s), mailto, tel and bare domains (backend validates too)\n      if (/^(mailto:|tel:)/i.test(value)) return true;\n      if (/^www\\./i.test(value)) return true;\n      // Try URL parsing, prepend http if missing scheme\n      const u = new URL(/^https?:\\/\\//i.test(value) ? value : `https://${value}`);\n      return !!u.hostname;\n    } catch {\n      return false;\n    }\n  };\n\n  const uploadFileFlow = async (file: File) => {\n    // 1) Ask backend for presigned URL and DB record\n    // Provide type hint derived from extension to satisfy API model validators\n    const typeName = getAttachmentTypeNameForFilename(file.name);\n    const createRes = await http.createAttachment({ caseId, originalName: file.name, type: typeName ? { name: typeName } : null, is_diagnosis: isDiagnosis });\n    const presignedUrl: string | null | undefined = (createRes as { url?: string | null; attachmentId?: number })?.url;\n    const createdAttachmentId: string | number | undefined = (createRes as { url?: string | null; attachmentId?: number })?.attachmentId;\n\n    if (!presignedUrl) {\n      throw new Error('Upload URL not returned');\n    }\n\n    // 2) PUT file to S3 directly\n    const urlObj = new URL(String(presignedUrl));\n    const signedContentType = urlObj.searchParams.get('Content-Type') || undefined;\n    const putRes = await fetch(presignedUrl, {\n      method: 'PUT',\n      headers: signedContentType ? { 'Content-Type': signedContentType } : (file.type ? { 'Content-Type': file.type } : {}),\n      body: file,\n    });\n    if (!putRes.ok) {\n      const text = await putRes.text();\n      // Attempt to delete the created DB record on failure\n      try {\n        if (createdAttachmentId && typeof caseId === 'number') {\n          await http.deleteAttachment({ attachmentId: String(createdAttachmentId), caseId });\n        }\n      } catch {\n        // If cleanup fails, we leave the failed record; API might have marked it successfully though\n      }\n      throw new Error(text || 'Failed to upload to storage');\n    }\n    // Report created attachment id back to parent\n    if (createdAttachmentId) {\n      const idNum = typeof createdAttachmentId === 'number' ? createdAttachmentId : Number(createdAttachmentId);\n      if (!Number.isNaN(idNum)) {\n        onUploaded?.(idNum, file.name, typeName || undefined);\n      }\n    }\n  };\n\n  const uploadLinkFlow = async (urlValue: string, description: string) => {\n    const res = await http.createAttachment({ caseId, url: urlValue, description, type: { name: 'Link' }, is_diagnosis: isDiagnosis });\n    if (res && typeof res.attachmentId === 'number') {\n      onUploaded?.(res.attachmentId, description || urlValue, 'Link');\n    }\n  };\n\n  const decodeQrFromImage = async (file: File): Promise<string | null> => {\n    const jsQRModule = await import('jsqr');\n    const jsQR = jsQRModule.default as unknown as (data: Uint8ClampedArray, width: number, height: number) => { data: string } | null;\n\n    const drawToCanvas = async (img: HTMLImageElement | ImageBitmap) => {\n      const width: number = (img as HTMLImageElement).width ?? (img as ImageBitmap).width ?? 0;\n      const height: number = (img as HTMLImageElement).height ?? (img as ImageBitmap).height ?? 0;\n      const canvas = document.createElement('canvas');\n      canvas.width = width;\n      canvas.height = height;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return null;\n      ctx.drawImage(img as CanvasImageSource, 0, 0);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const code = jsQR(imageData.data, imageData.width, imageData.height);\n      return code?.data || null;\n    };\n\n    // Handle SVG separately by rasterizing via Image element\n    if (/\\.svg$/i.test(file.name) || file.type === 'image/svg+xml') {\n      const dataUrl: string = await new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(String(reader.result));\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n      });\n      const img = await new Promise<HTMLImageElement>((resolve, reject) => {\n        const image = new Image();\n        image.onload = () => resolve(image);\n        image.onerror = reject;\n        image.src = dataUrl;\n      });\n      return drawToCanvas(img);\n    }\n\n    const bitmap = await createImageBitmap(file);\n    return drawToCanvas(bitmap);\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setError(null);\n      setIsSubmitting(true);\n\n      if (mode === 'file') {\n        const file = fileInputRef.current?.files?.[0];\n        if (!file) throw new Error('Please select a file');\n        await uploadFileFlow(file);\n      } else if (mode === 'link') {\n        const value = (getValues('linkUrl') || '').trim();\n        if (!validateUrl(value)) throw new Error('Please enter a valid link');\n        const desc = (getValues('description') || '').trim();\n        if (!desc) throw new Error('Please enter a description');\n        // Normalize domain-only to https://\n        const normalized = /^(https?:\\/\\/|mailto:|tel:)/i.test(value) ? value : (value.startsWith('www.') ? `https://${value}` : `https://${value}`);\n        await uploadLinkFlow(normalized, desc);\n      } else if (mode === 'qr') {\n        const file = qrInputRef.current?.files?.[0];\n        if (!file) throw new Error('Please select an image or PDF with QR');\n\n        if (/\\.pdf$/i.test(file.name)) {\n          // Basic PDF path: rely on user to upload a screenshot/image for now\n          throw new Error('QR decoding from PDF is not supported in-browser. Please upload an image containing the QR code.');\n        }\n\n        const decoded = await decodeQrFromImage(file);\n        if (!decoded) throw new Error('Could not read a QR code from the image');\n        if (!validateUrl(decoded)) throw new Error('QR code does not contain a valid link');\n        const desc = (getValues('description') || '').trim();\n        if (!desc) throw new Error('Please enter a description');\n        const normalized = /^(https?:\\/\\/|mailto:|tel:)/i.test(decoded) ? decoded : (decoded.startsWith('www.') ? `https://${decoded}` : `https://${decoded}`);\n        await uploadLinkFlow(normalized, desc);\n      }\n      onClose();\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // ---------- File selection helpers ----------\n  const allowedFileExtensions = buildAcceptStringForAllFiles().split(',');\n  const allowedQrExtensions = buildAcceptStringForQrImages().split(',');\n\n  const validateExtension = (filename: string, allowed: string[]): boolean => {\n    const lower = filename.toLowerCase();\n    return allowed.some(ext => lower.endsWith(ext));\n  };\n\n  const onChooseFileClick = () => fileInputRef.current?.click();\n  const onChooseQrClick = () => qrInputRef.current?.click();\n\n  const onFileSelected = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    if (!validateExtension(file.name, allowedFileExtensions)) {\n      setSelectedFileName('');\n      e.currentTarget.value = '';\n      setError(t('validation.fileTypeNotAllowed') || 'This file type is not allowed');\n      return;\n    }\n    setError(null);\n    setSelectedFileName(file.name);\n  };\n\n  const onQrSelected = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    if (!validateExtension(file.name, allowedQrExtensions)) {\n      setSelectedQrFileName('');\n      e.currentTarget.value = '';\n      setError(t('validation.fileTypeNotAllowed') || 'This file type is not allowed');\n      return;\n    }\n    if (/\\.pdf$/i.test(file.name)) {\n      // Just in case, although accept excludes pdf for QR\n      setSelectedQrFileName('');\n      e.currentTarget.value = '';\n      setError(t('case.details.qrPdfNotSupported') || 'QR decoding from PDF is not supported');\n      return;\n    }\n    setError(null);\n    setSelectedQrFileName(file.name);\n  };\n  // -------------------------------------------\n\n  const renderStep = () => {\n    if (mode === 'file') {\n      return (\n        <div className=\"p-6 space-y-4\">\n          <p className=\"text-sm text-foreground-secondary\">{t('case.details.uploadFileHint') || 'Upload PNG, JPG, JPEG, PDF, DICOM, NIfTI, etc.'}</p>\n          <div className=\"flex items-center gap-3\">\n          <input\n              ref={fileInputRef}\n              type=\"file\"\n            accept={buildAcceptStringForAllFiles()}\n              className=\"hidden\"\n              onChange={onFileSelected}\n            />\n            <button\n              type=\"button\"\n              onClick={onChooseFileClick}\n              className=\"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700\"\n            >\n              {t('common.chooseFile') || 'Choose file'}\n            </button>\n            <span className=\"text-sm text-foreground-secondary\">\n              {selectedFileName ? `${t('common.selectedFile') || 'Selected'}: ${selectedFileName}` : (t('common.noFileChosen') || 'No file chosen')}\n            </span>\n          </div>\n        </div>\n      );\n    }\n    if (mode === 'link') {\n      return (\n        <div className=\"p-6 space-y-4\">\n          <FormInputField<LinkForm>\n            label={t('case.details.modeLink') || 'Link'}\n            name={'linkUrl' as Path<LinkForm>}\n            register={register}\n            type=\"url\"\n            validation={{\n              required: 'Link is required',\n              validate: (value: string) => validateUrl(value) || 'Please enter a valid link'\n            }}\n            error={errors.linkUrl?.message as string}\n          />\n          <p className=\"text-xs text-foreground-tertiary\">{t('case.details.linkHint') || 'Accepts http(s), mailto:, tel:, or domain names. Will be validated.'}</p>\n          <FormInputField<LinkForm>\n            label={'Description'}\n            name={'description' as Path<LinkForm>}\n            register={register}\n            required={true}\n            validation={{ required: 'Description is required', maxLength: { value: 256, message: 'Max 256 characters' } }}\n            error={errors.description?.message as string}\n          />\n        </div>\n      );\n    }\n    return (\n      <div className=\"p-6 space-y-4\">\n        <p className=\"text-sm text-foreground-secondary\">{t('case.details.qrHint') || 'Upload an image (PNG/JPG/JPEG/SVG) containing a QR code. We will read it and store the link.'}</p>\n        <div className=\"flex items-center gap-3\">\n          <input\n            ref={qrInputRef}\n            type=\"file\"\n            accept={buildAcceptStringForQrImages()}\n            className=\"hidden\"\n            onChange={onQrSelected}\n          />\n          <button\n            type=\"button\"\n            onClick={onChooseQrClick}\n            className=\"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700\"\n          >\n            {t('common.chooseFile') || 'Choose file'}\n          </button>\n          <span className=\"text-sm text-foreground-secondary\">\n            {selectedQrFileName ? `${t('common.selectedFile') || 'Selected'}: ${selectedQrFileName}` : (t('common.noFileChosen') || 'No file chosen')}\n          </span>\n        </div>\n        <FormInputField<LinkForm>\n          label={'Description'}\n          name={'description' as Path<LinkForm>}\n          register={register}\n          required={true}\n          validation={{ required: 'Description is required', maxLength: { value: 256, message: 'Max 256 characters' } }}\n          error={errors.description?.message as string}\n        />\n      </div>\n    );\n  };\n\n  // Determine whether submit is allowed based on current mode\n  const canSubmit = (() => {\n    if (mode === 'file') {\n      return Boolean(selectedFileName);\n    }\n    if (mode === 'link') {\n      return Boolean(watchedDescription?.trim()) && Boolean(watchedLinkUrl) && validateUrl(watchedLinkUrl);\n    }\n    // mode === 'qr'\n    return Boolean(selectedQrFileName) && Boolean(watchedDescription?.trim());\n  })();\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title={t('case.details.upload') || 'Upload'} size=\"lg\">\n      {/* Mode Selector */}\n      <div className=\"px-6 pt-4\">\n        <div className=\"inline-flex rounded-md border border-border-primary overflow-hidden w-full\">\n          {(['file','link','qr'] as UploadMode[]).map((m) => (\n            <button\n              key={m}\n              className={`px-4 py-2 text-sm w-full ${mode === m ? 'bg-primary-600 text-white' : 'bg-background-secondary text-foreground-primary'}`}\n              onClick={() => setMode(m)}\n              disabled={isSubmitting}\n            >\n              {m === 'file' ? (t('case.details.modeFile') || 'File') : m === 'link' ? (t('case.details.modeLink') || 'Link') : (t('case.details.modeQr') || 'QR')}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Diagnosis flag removed from UI; parent controls via prop */}\n\n      {renderStep()}\n\n      {error && <div className=\"px-6 pb-2 text-sm text-red-600\">{error}</div>}\n\n      <div className=\"px-6 pb-6 flex justify-end gap-3\">\n        <button onClick={onClose} className=\"px-4 py-2 rounded-md border border-border-primary\">\n          {t('common.cancel') || 'Cancel'}\n        </button>\n        <button onClick={handleSubmit} disabled={isSubmitting || !canSubmit} className=\"px-4 py-2 rounded-md bg-primary-600 text-white disabled:opacity-60\">\n          {isSubmitting ? (t('common.working') || 'Working...') : (t('common.submit') || 'Submit')}\n        </button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default UploadAttachmentWizard;\n\n\n","import React from 'react';\n\ninterface DividerProps {\n  marginClass?: string; // e.g., 'my-3', 'my-1'\n  colorVar?: string;    // CSS var name or any valid color value\n  className?: string;\n}\n\nconst Divider: React.FC<DividerProps> = ({ marginClass = 'my-3', colorVar = 'var(--border-secondary)', className = '' }) => {\n  return (\n    <div className={`${marginClass} flex justify-center ${className}`}>\n      <div className=\"h-[1px] w-full\" style={{ backgroundColor: colorVar }} />\n    </div>\n  );\n};\n\nexport default Divider;\n\n\n","import { UseFormRegister, RegisterOptions, FieldValues, Path } from 'react-hook-form';\nimport { ExclamationCircleIcon } from '@heroicons/react/24/outline';\n\ninterface FormInputFieldProps<T extends FieldValues> {\n  label: string;\n  name: Path<T>;\n  register: UseFormRegister<T>;\n  error?: string;\n  required?: boolean;\n  tooltip?: string;\n  validation?: RegisterOptions<T>;\n  className?: string;\n  type?: 'text' | 'email' | 'password' | 'number' | 'tel' | 'url' | 'date';\n  placeholder?: string;\n}\n\nexport const FormInputField = <T extends FieldValues>({\n  label,\n  name,\n  register,\n  error,\n  required = false,\n  tooltip,\n  validation = {},\n  className = '',\n  type = 'text',\n  placeholder\n}: FormInputFieldProps<T>) => {\n  return (\n    <div className={`mb-4 ${className}`}>\n      <div className=\"flex items-center gap-1\">\n        <label className=\"block text-base font-medium text-heading mb-2\">\n          {label}\n          {required && <span className=\"text-error-500 ml-1\">*</span>}\n        </label>\n        {tooltip && (\n          <div className=\"relative group\">\n            <span className=\"cursor-help text-foreground-tertiary hover:text-foreground-secondary\">\n              <ExclamationCircleIcon className=\"w-4 h-4\" />\n            </span>\n            <div className=\"absolute z-10 invisible group-hover:visible bg-neutral-900 text-white text-sm rounded p-2 bottom-full mb-1 w-48\">\n              {tooltip}\n            </div>\n          </div>\n        )}\n      </div>\n      <input\n        type={type}\n        placeholder={placeholder}\n        {...register(name, validation)}\n        className=\"input-field\"\n      />\n      {error && <p className=\"mt-2 text-sm text-error-600\">{error}</p>}\n    </div>\n  );\n};","import React, { useEffect } from 'react';\nimport { useLanguage } from '@/contexts/LanguageContext';\nimport { XMarkIcon } from '@heroicons/react/24/outline';\n\ninterface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  children: React.ReactNode;\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\n}\n\nconst Modal: React.FC<ModalProps> = ({ \n  isOpen, \n  onClose, \n  title, \n  children, \n  size = 'lg' \n}) => {\n  const { t } = useLanguage();\n\n  // Handle escape key press\n  useEffect(() => {\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      // Prevent body scroll when modal is open\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  if (!isOpen) return null;\n\n  const sizeClasses = {\n    sm: 'max-w-md',\n    md: 'max-w-lg',\n    lg: 'max-w-2xl',\n    xl: 'max-w-7xl',\n    full: 'max-w-7xl'\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div \n        className=\"fixed inset-0 bg-black bg-opacity-50 transition-opacity\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div \n          className={`relative bg-background-primary rounded-xl shadow-xl border border-border-primary w-full ${sizeClasses[size]} max-h-[90vh] overflow-hidden`}\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* Header */}\n          {title && (\n            <div className=\"flex items-center justify-between p-6 border-b border-border-primary\">\n              <h2 className=\"text-xl font-semibold text-foreground-primary\">\n                {title}\n              </h2>\n              <button\n                onClick={onClose}\n                className=\"text-foreground-tertiary hover:text-foreground-primary transition-colors duration-200 p-1 rounded-lg hover:bg-background-secondary\"\n                aria-label={t('common.close') || 'Close'}\n              >\n                <XMarkIcon className=\"w-6 h-6\" />\n              </button>\n            </div>\n          )}\n          \n          {/* Content */}\n          <div className=\"overflow-y-auto max-h-[calc(90vh-120px)]\">\n            {children}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Modal; ","import * as React from \"react\";\nfunction TrashIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(TrashIcon);\nexport default ForwardRef;"],"names":["items","onOpen","AttachmentList","onDelete","openText","deleteText","showOpen","isOpenDisabled","workingText","div","className","length","map","item","index","label","metaLeft","metaRight","typeName","span","showDelete","button","onClick","id","disabled","title","TrashIcon","p","ATTACHMENT_TYPES","name","extensions","patterns","buildAcceptStringForAllFiles","unique","Set","spec","ext","add","delete","Array","from","join","buildAcceptStringForQrImages","isOpen","onClose","UploadAttachmentWizard","caseId","onUploaded","isDiagnosis","t","useLanguage","mode","setMode","useState","isSubmitting","setIsSubmitting","error","setError","fileInputRef","useRef","qrInputRef","selectedFileName","setSelectedFileName","selectedQrFileName","setSelectedQrFileName","http","HttpService","getInstance","register","getValues","reset","watch","formState","errors","useForm","watchedLinkUrl","watchedDescription","useEffect","current","value","linkUrl","description","validateUrl","test","URL","hostname","uploadFileFlow","file","getAttachmentTypeNameForFilename","input","lower","toLowerCase","endsWith","type","normalizedExt","startsWith","includes","some","re","createRes","createAttachment","originalName","is_diagnosis","presignedUrl","url","createdAttachmentId","attachmentId","signedContentType","urlObj","String","searchParams","get","undefined","putRes","fetch","method","headers","body","ok","text","deleteAttachment","idNum","Number","isNaN","uploadLinkFlow","urlValue","res","decodeQrFromImage","jsQR","jsQRModule","default","drawToCanvas","img","width","height","canvas","document","createElement","ctx","getContext","drawImage","imageData","getImageData","code","data","dataUrl","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsDataURL","image","Image","src","createImageBitmap","bitmap","handleSubmit","files","Error","trim","desc","normalized","decoded","allowedFileExtensions","split","allowedQrExtensions","validateExtension","filename","allowed","onChooseFileClick","click","onChooseQrClick","onFileSelected","e","target","currentTarget","onQrSelected","canSubmit","Boolean","Modal","size","m","renderStep","ref","accept","onChange","FormInputField","validation","required","validate","message","maxLength","marginClass","Divider","colorVar","style","backgroundColor","tooltip","placeholder","ExclamationCircleIcon","children","handleEscape","event","key","addEventListener","overflow","removeEventListener","sm","md","lg","xl","full","stopPropagation","h2","aria-label","XMarkIcon","React","svgRef","ForwardRef","titleId","props","Object","assign","xmlns","fill","viewBox","strokeWidth","stroke","strokeLinecap","strokeLinejoin","d"],"sourceRoot":"","ignoreList":[6]}