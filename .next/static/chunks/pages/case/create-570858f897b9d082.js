(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{788:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/case/create",function(){return s(5470)}])},5470:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var a=s(4848),r=s(6540),i=s(6424),n=s(6578),l=s(98),d=s(9785),o=s(311),c=s(2765),m=s(3722),u=s(1023),h=s(9868),x=s(9938),p=s(5287),y=s(2349),g=s(656);let b=e=>{let{attachments:t,onAddDetailed:s,onDelete:i,onValidityChange:n}=e,{t:d}=(0,l.o)(),[o,c]=(0,r.useState)(!1),m=h.k.getInstance();return r.useEffect(()=>{null==n||n((t||[]).length>0)},[t,n]),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-body",children:d("case.create.diagnosisUploadInfo")||"Upload your diagnosis files now. They will be linked to your case after creation."}),(0,a.jsx)(y.A,{isOpen:o,onClose:()=>c(!1),isDiagnosis:!0,onUploaded:(e,t,a)=>{"number"==typeof e&&s({id:e,originalName:t||void 0,typeName:a||"File"})}}),(0,a.jsx)(g.A,{items:(t||[]).map((e,t)=>{var s;return{id:e.id||t,label:e.originalName||"Document ".concat(t+1),typeName:null===(s=e.type)||void 0===s?void 0:s.name,metaLeft:void 0,metaRight:void 0,showDelete:!0}}),showOpen:!1,openText:d("case.details.open")||"Open",deleteText:d("case.details.delete")||"Delete",onOpen:async e=>{if(!(t||[]).find(t=>String(t.id)===String(e)))return},onDelete:async e=>{try{await m.deleteAttachment({attachmentId:String(e),caseId:null})}catch(e){}null==i||i(Number(e))}}),!o&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(p.$,{type:"button",variant:"default",className:"bg-primary-600 hover:bg-primary-700 text-white",onClick:()=>c(!0),children:d("case.details.upload")||"Upload"})})]})},f=e=>{var t;let{onCaseDataSubmit:s,savedFormData:i,registerExternal:n}=e,{t:o}=(0,l.o)(),{register:c,handleSubmit:m,formState:{errors:u},watch:h,reset:x,setValue:p}=(0,d.mN)({defaultValues:i||{description:"",duration:"",severity:""}});r.useEffect(()=>{i&&(p("description",i.description||""),p("duration",i.duration||""),p("severity",i.severity||""))},[i,p]);let y=(0,r.useCallback)(async e=>{s({has_diagnosis:!1,symptoms:[{description:e.description,duration:e.duration,severity:e.severity}],formData:e})},[s]);return r.useEffect(()=>{n&&n({submit:()=>m(y)(),reset:()=>x()})},[n,m,y,x]),(0,a.jsxs)("form",{onSubmit:m(y),className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-base font-medium text-heading mb-2",children:[o("symptoms.description"),(0,a.jsx)("span",{className:"text-error-500 ml-1",children:"*"})]}),(0,a.jsx)("textarea",{...c("description",{required:o("symptoms.required"),maxLength:{value:2e3,message:o("symptoms.maxLengthExceeded")}}),rows:4,maxLength:2e3,className:"input-field resize-none",placeholder:o("symptoms.placeholder")}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[u.description&&(0,a.jsx)("p",{className:"text-sm text-error-600",children:u.description.message}),(0,a.jsxs)("span",{className:"text-sm text-body-secondary ml-auto",children:[(null===(t=h("description"))||void 0===t?void 0:t.length)||0,"/2000"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-base font-medium text-heading mb-2",children:[o("symptoms.duration"),(0,a.jsx)("span",{className:"text-error-500 ml-1",children:"*"})]}),(0,a.jsxs)("select",{...c("duration",{required:o("symptoms.durationRequired")}),className:"input-field",children:[(0,a.jsx)("option",{value:"",children:o("symptoms.selectDuration")}),(0,a.jsx)("option",{value:"less_than_24h",children:o("symptoms.lessThan24h")}),(0,a.jsx)("option",{value:"1_to_3_days",children:o("symptoms.1to3Days")}),(0,a.jsx)("option",{value:"3_to_7_days",children:o("symptoms.3to7Days")}),(0,a.jsx)("option",{value:"1_to_2_weeks",children:o("symptoms.1to2Weeks")}),(0,a.jsx)("option",{value:"more_than_2_weeks",children:o("symptoms.moreThan2Weeks")})]}),u.duration&&(0,a.jsx)("p",{className:"mt-2 text-sm text-error-600",children:u.duration.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-base font-medium text-heading mb-2",children:[o("symptoms.severity"),(0,a.jsx)("span",{className:"text-error-500 ml-1",children:"*"})]}),(0,a.jsxs)("select",{...c("severity",{required:o("symptoms.severityRequired")}),className:"input-field",children:[(0,a.jsx)("option",{value:"",children:o("symptoms.selectSeverity")}),(0,a.jsx)("option",{value:"mild",children:o("symptoms.mild")}),(0,a.jsx)("option",{value:"moderate",children:o("symptoms.moderate")}),(0,a.jsx)("option",{value:"severe",children:o("symptoms.severe")})]}),u.severity&&(0,a.jsx)("p",{className:"mt-2 text-sm text-error-600",children:u.severity.message})]})]})};var v=s(1028);let j=e=>{let{user:t}=e,s=(0,i.useRouter)(),{t:y}=(0,l.o)(),{addNotification:g}=(0,u.E)(),{handleCustomError:j}=(0,x.ux)(),{updateUser:N}=(0,n.A)(),[w,D]=(0,r.useState)(!1),[_,k]=(0,r.useState)(1),[C,O]=(0,r.useState)(null),[S,E]=(0,r.useState)(null),[A,B]=(0,r.useState)(!1),[R,I]=(0,r.useState)([]),q=r.useRef(null),T=r.useRef(null),{register:z,handleSubmit:F,formState:{errors:L},reset:$,watch:U}=(0,d.mN)({defaultValues:t?{...t,day:t.dateOfBirth?new Date(t.dateOfBirth).getDate():void 0,month:t.dateOfBirth?new Date(t.dateOfBirth).getMonth()+1:void 0,year:t.dateOfBirth?new Date(t.dateOfBirth).getFullYear():void 0}:{id:"",firstName:"",lastName:"",createdAt:new Date,updatedAt:new Date,address:void 0,day:void 0,month:void 0,year:void 0},mode:"onChange"});r.useEffect(()=>{t&&$({...t,day:t.dateOfBirth?new Date(t.dateOfBirth).getDate():void 0,month:t.dateOfBirth?new Date(t.dateOfBirth).getMonth()+1:void 0,year:t.dateOfBirth?new Date(t.dateOfBirth).getFullYear():void 0})},[t,$]);let P=(0,r.useCallback)(async e=>{O(e.formData),E(e.formData),B(e.has_diagnosis),k(2)},[]),V=async e=>{D(!0);try{let t={...e};e.day&&e.month&&e.year&&(t.dateOfBirth=new Date(Date.UTC(e.year,e.month-1,e.day)));let a=e=>{if(""===e||null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){let t=e.trim();if(""===t)return null;let s=Number(t);return Number.isFinite(s)?s:null}return null};if(t.height=a(e.height),t.weight=a(e.weight),delete t.day,delete t.month,delete t.year,e.address){let{county:s,city:a,postalCode:r,street:i,houseNumber:n}=e.address;s&&a&&r&&i&&n?t.address={...e.address,country:e.address.country&&""!==e.address.country.trim()?e.address.country:"Rom\xe2nia",block:e.address.block||null,entranceNumber:e.address.entranceNumber||null,floor:e.address.floor||null,apartmentNumber:e.address.apartmentNumber||null}:delete t.address}await N(t),g("success",y("profile.userDataSaved")||"User data updated successfully",3e3);let r=h.k.getInstance();if(!A&&(!C||!C.description||!C.duration||!C.severity)){j(x.yG.VALIDATION_ERROR,y("symptoms.required")||"Please fill in all required fields"),D(!1);return}let i=A?{has_diagnosis:!0,symptoms:[],custom_notes:null,attachments:R.map(e=>({id:e.id,originalName:e.originalName||null,type:{name:e.type.name},is_diagnosis:!0}))}:{has_diagnosis:!1,symptoms:[{description:C.description,duration:C.duration,severity:C.severity}],custom_notes:null};await r.createCase(i),g("success",y("symptoms.submitted"),5e3),s.push("/user/profile")}finally{D(!1)}},X=()=>{k(_-1)};return(0,a.jsx)("div",{className:"min-h-screen bg-background-secondary py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"card-elevated",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-heading mb-2",children:y("wizard.createCase")}),(0,a.jsx)("p",{className:"text-body",children:y("wizard.createCaseDescription")})]}),(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsxs)("div",{className:"flex items-center ".concat(_>=1?"text-primary-600":"text-gray-400"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2 ".concat(_>=1?"bg-primary-600 border-primary-600 text-white":"border-gray-300"),children:"1"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:y("symptoms.title")||"Symptoms"})]}),(0,a.jsx)("div",{className:"w-16 h-0.5 mx-4 ".concat(_>=2?"bg-primary-600":"bg-gray-300")}),(0,a.jsxs)("div",{className:"flex items-center ".concat(_>=2?"text-primary-600":"text-gray-400"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2 ".concat(_>=2?"bg-primary-600 border-primary-600 text-white":"border-gray-300"),children:"2"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:y("wizard.personalInfo")})]}),(0,a.jsx)("div",{className:"w-16 h-0.5 mx-4 ".concat(_>=3?"bg-primary-600":"bg-gray-300")}),(0,a.jsxs)("div",{className:"flex items-center ".concat(_>=3?"text-primary-600":"text-gray-400"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center border-2 ".concat(_>=3?"bg-primary-600 border-primary-600 text-white":"border-gray-300"),children:"3"}),(0,a.jsx)("span",{className:"ml-2 font-medium",children:y("wizard.demographic")})]})]})}),(0,a.jsx)(v.A,{marginClass:"my-1"}),1===_&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:A?y("case.details.documents")||"Documents":y("symptoms.title")}),(0,a.jsx)("div",{className:"flex items-center p-3 bg-neutral-50 rounded-md border border-border-primary",children:(0,a.jsxs)("label",{htmlFor:"hasDiagnosis",className:"flex items-center gap-3 cursor-pointer",children:[(0,a.jsx)("input",{id:"hasDiagnosis",type:"checkbox",className:"sr-only",checked:A,onChange:e=>B(e.target.checked)}),(0,a.jsx)("div",{className:"relative inline-flex h-6 w-11 rounded-full transition-colors ".concat(A?"bg-primary-600":"bg-neutral-300"),children:(0,a.jsx)("span",{className:"absolute top-0.5 left-0.5 inline-block h-5 w-5 rounded-full bg-white shadow transform transition-transform ".concat(A?"translate-x-5":"translate-x-0")})}),(0,a.jsx)("span",{className:"text-sm text-foreground-primary",children:y("case.create.hasDiagnosis")||"I already have a diagnosis"})]})}),A?(0,a.jsx)(b,{attachments:R.map(e=>({id:e.id,originalName:e.originalName,type:{name:e.type.name}})),onAddDetailed:e=>{let{id:t,originalName:s,typeName:a}=e;I(e=>{let r=e.findIndex(e=>e.originalName===s||e.id===t);if(r>=0){let i=[...e];return i[r]={id:t,originalName:i[r].originalName||s,type:{name:a}},i}return[...e,{id:t,originalName:s,type:{name:a}}]})},onDelete:e=>I(t=>t.filter(t=>t.id!==e))}):(0,a.jsx)(f,{onCaseDataSubmit:P,savedFormData:S,registerExternal:e=>{let{submit:t,reset:s}=e;q.current=t,T.current=s}}),(0,a.jsx)(v.A,{marginClass:"my-1"}),(0,a.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[!A&&(0,a.jsx)(p.$,{type:"button",variant:"secondary",onClick:()=>{var e;return null===(e=T.current)||void 0===e?void 0:e.call(T)},className:"bg-neutral-100 text-neutral-700 border-neutral-300 hover:bg-neutral-200 hover:text-neutral-800",children:y("symptoms.reset")}),(0,a.jsx)(p.$,{type:"button",variant:"default",onClick:()=>{if(A)R.length>0&&k(2);else{var e;null===(e=q.current)||void 0===e||e.call(q)}},disabled:A&&0===R.length,className:"bg-primary-600 hover:bg-primary-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:y("common.next")})]})]}),2===_&&(0,a.jsxs)("form",{onSubmit:F(V),className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:y("profile.personalInformation")}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)(o.d,{register:z,errors:L})}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)(c.X,{register:z,errors:L})}),(0,a.jsxs)("div",{className:"flex justify-between gap-3 pt-6 border-t border-gray-200",children:[(0,a.jsx)(p.$,{type:"button",variant:"secondary",onClick:X,className:"bg-neutral-100 text-neutral-700 border-neutral-300 hover:bg-neutral-200 hover:text-neutral-800",children:y("common.back")}),(0,a.jsx)(p.$,{type:"button",variant:"default",onClick:()=>k(3),disabled:!(()=>{var e,t,s,a,r;let i=U();return!!(i.firstName&&i.lastName&&(null===(e=i.address)||void 0===e?void 0:e.county)&&(null===(t=i.address)||void 0===t?void 0:t.city)&&(null===(s=i.address)||void 0===s?void 0:s.postalCode)&&(null===(a=i.address)||void 0===a?void 0:a.street)&&(null===(r=i.address)||void 0===r?void 0:r.houseNumber))})(),className:"bg-primary-600 hover:bg-primary-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:y("common.next")})]})]}),3===_&&(0,a.jsxs)("form",{onSubmit:F(V),className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:y("wizard.demographic")}),(0,a.jsx)(m.g,{register:z,errors:L}),(0,a.jsxs)("div",{className:"flex justify-between gap-3 pt-6 border-t border-gray-200",children:[(0,a.jsx)(p.$,{type:"button",variant:"secondary",onClick:X,className:"bg-neutral-100 text-neutral-700 border-neutral-300 hover:bg-neutral-200 hover:text-neutral-800",children:y("common.back")}),(0,a.jsx)(p.$,{type:"submit",variant:"default",disabled:w||!(()=>{let e=U(),t=!!e.gender,s=!!e.day,a=!!e.month,r=!!e.year,i=!!(L.gender||L.day||L.month||L.year);return t&&s&&a&&r&&!i})(),className:"bg-primary-600 hover:bg-primary-700 text-white shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:w?y("common.loading"):y("wizard.saveAndSubmit")})]})]})]})})})};function N(){let e=(0,i.useRouter)(),{isAuthenticated:t,loading:s,user:d,userLoading:o,userGroups:c}=(0,n.A)(),{t:m}=(0,l.o)(),u=c.includes("patient");return(r.useEffect(()=>{!t||s||o||!d||u||e.replace("/user/profile")},[t,s,o,d,u,e]),t)?d?(0,a.jsx)(j,{user:d}):void 0:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background-secondary",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-heading mb-4",children:m("auth.loginRequired")||"Login Required"}),(0,a.jsx)("p",{className:"text-body mb-6",children:m("auth.loginToCreateCase")||"Please log in to create a medical case."}),(0,a.jsx)("button",{onClick:()=>e.push("/auth/login"),className:"bg-primary-600 hover:bg-primary-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors",children:m("auth.login")||"Login"})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[785,568,294,636,593,792],()=>t(788)),_N_E=e.O()}]);
//# sourceMappingURL=create-570858f897b9d082.js.map