{"version":3,"file":"625.js","mappings":"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","sources":["webpack://website/./node_modules/next/dist/build/templates/helpers.js","webpack://website/./src/components/attachment/AttachmentList.tsx","webpack://website/./src/components/case/UploadAttachmentWizard.tsx","webpack://website/./src/components/common/Divider.tsx","webpack://website/./src/components/common/FormInputField.tsx","webpack://website/./src/components/common/Modal.tsx","webpack://website/./src/lib/attachmentTypeUtils.ts","webpack://website/./src/pages/_document.tsx","webpack://website/./node_modules/next/dist/server/route-kind.js","webpack://website/./node_modules/@heroicons/react/24/outline/esm/TrashIcon.js"],"sourcesContent":["/**\n * Hoists a name from a module or promised module.\n *\n * @param module the module to hoist the name from\n * @param name the name to hoist\n * @returns the value on the module (or promised module)\n */ \"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"hoist\", {\n    enumerable: true,\n    get: function() {\n        return hoist;\n    }\n});\nfunction hoist(module, name) {\n    // If the name is available in the module, return it.\n    if (name in module) {\n        return module[name];\n    }\n    // If a property called `then` exists, assume it's a promise and\n    // return a promise that resolves to the name.\n    if ('then' in module && typeof module.then === 'function') {\n        return module.then((mod)=>hoist(mod, name));\n    }\n    // If we're trying to hoise the default export, and the module is a function,\n    // return the module itself.\n    if (typeof module === 'function' && name === 'default') {\n        return module;\n    }\n    // Otherwise, return undefined.\n    return undefined;\n}\n\n//# sourceMappingURL=helpers.js.map","import React from 'react';\nimport { TrashIcon } from '@heroicons/react/24/outline';\n\ninterface AttachmentListItem {\n  id: number | string;\n  label?: string;\n  metaLeft?: string;\n  metaRight?: string;\n  typeName?: string;\n  showDelete?: boolean;\n}\n\ninterface AttachmentListProps {\n  items: AttachmentListItem[];\n  onOpen?: (id: number | string) => void;\n  onDelete?: (id: number | string) => void;\n  openText?: string | ((item: AttachmentListItem) => string);\n  deleteText?: string;\n  showOpen?: boolean;\n  isOpenDisabled?: (item: AttachmentListItem) => boolean;\n  workingText?: string;\n}\n\nexport const AttachmentList: React.FC<AttachmentListProps> = ({ items, onOpen, onDelete, openText = 'Open', deleteText = 'Delete', showOpen = false, isOpenDisabled, workingText = 'Working...' }) => {\n  return (\n    <div className=\"space-y-3\">\n      {items.length > 0 ? (\n        items.map((item, index) => (\n          <div key={`${item.id}-${index}`} className=\"bg-neutral-50 rounded-md p-4 flex items-center justify-between border border-border-primary\">\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-foreground-primary\">\n                {item.label || `Attachment ${index + 1}`}\n              </div>\n              {(item.metaLeft || item.metaRight || item.typeName) && (\n                <div className=\"text-sm text-foreground-tertiary flex gap-4\">\n                  {item.typeName ? <span>{item.typeName}</span> : null}\n                  {item.metaLeft ? <span>{item.metaLeft}</span> : null}\n                  {item.metaRight ? <span>{item.metaRight}</span> : null}\n                </div>\n              )}\n            </div>\n            {(showOpen || item.showDelete) && (\n              <div className=\"flex items-center gap-2\">\n                {showOpen && onOpen && (\n                  <button onClick={() => onOpen(item.id)} disabled={isOpenDisabled ? isOpenDisabled(item) : false} className=\"bg-primary-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-60\">\n                    {isOpenDisabled && isOpenDisabled(item) ? workingText : (typeof openText === 'function' ? openText(item) : openText)}\n                  </button>\n                )}\n                {item.showDelete && onDelete && (\n                  <button onClick={() => onDelete(item.id)} className=\"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 transition-colors\" title={deleteText}>\n                    <TrashIcon className=\"w-4 h-4\" />\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        ))\n      ) : (\n        <div className=\"text-center py-8 text-foreground-tertiary\">\n          <p className=\"text-sm\">No attachments yet</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AttachmentList;\n\n\n","import React, { useEffect, useRef, useState } from 'react';\nimport Modal from '@/components/common/Modal';\nimport { useLanguage } from '@/contexts/LanguageContext';\nimport { HttpService } from '@/services/httpService';\nimport { getAttachmentTypeNameForFilename, buildAcceptStringForAllFiles, buildAcceptStringForQrImages } from '@/lib/attachmentTypeUtils';\nimport { useForm, Path } from 'react-hook-form';\nimport { FormInputField } from '@/components/common/FormInputField';\n\ntype UploadMode = 'file' | 'link' | 'qr';\n\ninterface UploadAttachmentWizardProps {\n  isOpen: boolean;\n  onClose: () => void;\n  caseId?: number;\n  onUploaded?: (attachmentId?: number, displayName?: string, typeName?: string) => void;\n  isDiagnosis?: boolean;\n}\n\ntype LinkForm = { linkUrl: string; description: string };\n\nexport const UploadAttachmentWizard: React.FC<UploadAttachmentWizardProps> = ({ isOpen, onClose, caseId, onUploaded, isDiagnosis = false }) => {\n  const { t } = useLanguage();\n  const [mode, setMode] = useState<UploadMode>('file');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const qrInputRef = useRef<HTMLInputElement | null>(null);\n  const [selectedFileName, setSelectedFileName] = useState<string>('');\n  const [selectedQrFileName, setSelectedQrFileName] = useState<string>('');\n\n  const http = HttpService.getInstance();\n\n  const { register, getValues, reset, watch, formState: { errors } } = useForm<{ linkUrl: string; description: string }>();\n\n  const watchedLinkUrl = watch('linkUrl');\n  const watchedDescription = watch('description');\n\n  // Reset ephemeral state whenever the modal opens\n  useEffect(() => {\n    if (isOpen) {\n      setSelectedFileName('');\n      setSelectedQrFileName('');\n      setError(null);\n      try {\n        if (fileInputRef.current) {\n          fileInputRef.current.value = '';\n        }\n        if (qrInputRef.current) {\n          qrInputRef.current.value = '';\n        }\n      } catch {}\n      reset({ linkUrl: '', description: '' });\n    }\n  }, [isOpen, reset]);\n\n  const validateUrl = (value: string) => {\n    try {\n      // Accepts http(s), mailto, tel and bare domains (backend validates too)\n      if (/^(mailto:|tel:)/i.test(value)) return true;\n      if (/^www\\./i.test(value)) return true;\n      // Try URL parsing, prepend http if missing scheme\n      const u = new URL(/^https?:\\/\\//i.test(value) ? value : `https://${value}`);\n      return !!u.hostname;\n    } catch {\n      return false;\n    }\n  };\n\n  const uploadFileFlow = async (file: File) => {\n    // 1) Ask backend for presigned URL and DB record\n    // Provide type hint derived from extension to satisfy API model validators\n    const typeName = getAttachmentTypeNameForFilename(file.name);\n    const createRes = await http.createAttachment({ caseId, originalName: file.name, type: typeName ? { name: typeName } : null, is_diagnosis: isDiagnosis });\n    const presignedUrl: string | null | undefined = (createRes as { url?: string | null; attachmentId?: number })?.url;\n    const createdAttachmentId: string | number | undefined = (createRes as { url?: string | null; attachmentId?: number })?.attachmentId;\n\n    if (!presignedUrl) {\n      throw new Error('Upload URL not returned');\n    }\n\n    // 2) PUT file to S3 directly\n    const urlObj = new URL(String(presignedUrl));\n    const signedContentType = urlObj.searchParams.get('Content-Type') || undefined;\n    const putRes = await fetch(presignedUrl, {\n      method: 'PUT',\n      headers: signedContentType ? { 'Content-Type': signedContentType } : (file.type ? { 'Content-Type': file.type } : {}),\n      body: file,\n    });\n    if (!putRes.ok) {\n      const text = await putRes.text();\n      // Attempt to delete the created DB record on failure\n      try {\n        if (createdAttachmentId && typeof caseId === 'number') {\n          await http.deleteAttachment({ attachmentId: String(createdAttachmentId), caseId });\n        }\n      } catch {\n        // If cleanup fails, we leave the failed record; API might have marked it successfully though\n      }\n      throw new Error(text || 'Failed to upload to storage');\n    }\n    // Report created attachment id back to parent\n    if (createdAttachmentId) {\n      const idNum = typeof createdAttachmentId === 'number' ? createdAttachmentId : Number(createdAttachmentId);\n      if (!Number.isNaN(idNum)) {\n        onUploaded?.(idNum, file.name, typeName || undefined);\n      }\n    }\n  };\n\n  const uploadLinkFlow = async (urlValue: string, description: string) => {\n    const res = await http.createAttachment({ caseId, url: urlValue, description, type: { name: 'Link' }, is_diagnosis: isDiagnosis });\n    if (res && typeof res.attachmentId === 'number') {\n      onUploaded?.(res.attachmentId, description || urlValue, 'Link');\n    }\n  };\n\n  const decodeQrFromImage = async (file: File): Promise<string | null> => {\n    const jsQRModule = await import('jsqr');\n    const jsQR = jsQRModule.default as unknown as (data: Uint8ClampedArray, width: number, height: number) => { data: string } | null;\n\n    const drawToCanvas = async (img: HTMLImageElement | ImageBitmap) => {\n      const width: number = (img as HTMLImageElement).width ?? (img as ImageBitmap).width ?? 0;\n      const height: number = (img as HTMLImageElement).height ?? (img as ImageBitmap).height ?? 0;\n      const canvas = document.createElement('canvas');\n      canvas.width = width;\n      canvas.height = height;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return null;\n      ctx.drawImage(img as CanvasImageSource, 0, 0);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const code = jsQR(imageData.data, imageData.width, imageData.height);\n      return code?.data || null;\n    };\n\n    // Handle SVG separately by rasterizing via Image element\n    if (/\\.svg$/i.test(file.name) || file.type === 'image/svg+xml') {\n      const dataUrl: string = await new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(String(reader.result));\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n      });\n      const img = await new Promise<HTMLImageElement>((resolve, reject) => {\n        const image = new Image();\n        image.onload = () => resolve(image);\n        image.onerror = reject;\n        image.src = dataUrl;\n      });\n      return drawToCanvas(img);\n    }\n\n    const bitmap = await createImageBitmap(file);\n    return drawToCanvas(bitmap);\n  };\n\n  const handleSubmit = async () => {\n    try {\n      setError(null);\n      setIsSubmitting(true);\n\n      if (mode === 'file') {\n        const file = fileInputRef.current?.files?.[0];\n        if (!file) throw new Error('Please select a file');\n        await uploadFileFlow(file);\n      } else if (mode === 'link') {\n        const value = (getValues('linkUrl') || '').trim();\n        if (!validateUrl(value)) throw new Error('Please enter a valid link');\n        const desc = (getValues('description') || '').trim();\n        if (!desc) throw new Error('Please enter a description');\n        // Normalize domain-only to https://\n        const normalized = /^(https?:\\/\\/|mailto:|tel:)/i.test(value) ? value : (value.startsWith('www.') ? `https://${value}` : `https://${value}`);\n        await uploadLinkFlow(normalized, desc);\n      } else if (mode === 'qr') {\n        const file = qrInputRef.current?.files?.[0];\n        if (!file) throw new Error('Please select an image or PDF with QR');\n\n        if (/\\.pdf$/i.test(file.name)) {\n          // Basic PDF path: rely on user to upload a screenshot/image for now\n          throw new Error('QR decoding from PDF is not supported in-browser. Please upload an image containing the QR code.');\n        }\n\n        const decoded = await decodeQrFromImage(file);\n        if (!decoded) throw new Error('Could not read a QR code from the image');\n        if (!validateUrl(decoded)) throw new Error('QR code does not contain a valid link');\n        const desc = (getValues('description') || '').trim();\n        if (!desc) throw new Error('Please enter a description');\n        const normalized = /^(https?:\\/\\/|mailto:|tel:)/i.test(decoded) ? decoded : (decoded.startsWith('www.') ? `https://${decoded}` : `https://${decoded}`);\n        await uploadLinkFlow(normalized, desc);\n      }\n      onClose();\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // ---------- File selection helpers ----------\n  const allowedFileExtensions = buildAcceptStringForAllFiles().split(',');\n  const allowedQrExtensions = buildAcceptStringForQrImages().split(',');\n\n  const validateExtension = (filename: string, allowed: string[]): boolean => {\n    const lower = filename.toLowerCase();\n    return allowed.some(ext => lower.endsWith(ext));\n  };\n\n  const onChooseFileClick = () => fileInputRef.current?.click();\n  const onChooseQrClick = () => qrInputRef.current?.click();\n\n  const onFileSelected = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    if (!validateExtension(file.name, allowedFileExtensions)) {\n      setSelectedFileName('');\n      e.currentTarget.value = '';\n      setError(t('validation.fileTypeNotAllowed') || 'This file type is not allowed');\n      return;\n    }\n    setError(null);\n    setSelectedFileName(file.name);\n  };\n\n  const onQrSelected = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    if (!validateExtension(file.name, allowedQrExtensions)) {\n      setSelectedQrFileName('');\n      e.currentTarget.value = '';\n      setError(t('validation.fileTypeNotAllowed') || 'This file type is not allowed');\n      return;\n    }\n    if (/\\.pdf$/i.test(file.name)) {\n      // Just in case, although accept excludes pdf for QR\n      setSelectedQrFileName('');\n      e.currentTarget.value = '';\n      setError(t('case.details.qrPdfNotSupported') || 'QR decoding from PDF is not supported');\n      return;\n    }\n    setError(null);\n    setSelectedQrFileName(file.name);\n  };\n  // -------------------------------------------\n\n  const renderStep = () => {\n    if (mode === 'file') {\n      return (\n        <div className=\"p-6 space-y-4\">\n          <p className=\"text-sm text-foreground-secondary\">{t('case.details.uploadFileHint') || 'Upload PNG, JPG, JPEG, PDF, DICOM, NIfTI, etc.'}</p>\n          <div className=\"flex items-center gap-3\">\n          <input\n              ref={fileInputRef}\n              type=\"file\"\n            accept={buildAcceptStringForAllFiles()}\n              className=\"hidden\"\n              onChange={onFileSelected}\n            />\n            <button\n              type=\"button\"\n              onClick={onChooseFileClick}\n              className=\"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700\"\n            >\n              {t('common.chooseFile') || 'Choose file'}\n            </button>\n            <span className=\"text-sm text-foreground-secondary\">\n              {selectedFileName ? `${t('common.selectedFile') || 'Selected'}: ${selectedFileName}` : (t('common.noFileChosen') || 'No file chosen')}\n            </span>\n          </div>\n        </div>\n      );\n    }\n    if (mode === 'link') {\n      return (\n        <div className=\"p-6 space-y-4\">\n          <FormInputField<LinkForm>\n            label={t('case.details.modeLink') || 'Link'}\n            name={'linkUrl' as Path<LinkForm>}\n            register={register}\n            type=\"url\"\n            validation={{\n              required: 'Link is required',\n              validate: (value: string) => validateUrl(value) || 'Please enter a valid link'\n            }}\n            error={errors.linkUrl?.message as string}\n          />\n          <p className=\"text-xs text-foreground-tertiary\">{t('case.details.linkHint') || 'Accepts http(s), mailto:, tel:, or domain names. Will be validated.'}</p>\n          <FormInputField<LinkForm>\n            label={'Description'}\n            name={'description' as Path<LinkForm>}\n            register={register}\n            required={true}\n            validation={{ required: 'Description is required', maxLength: { value: 256, message: 'Max 256 characters' } }}\n            error={errors.description?.message as string}\n          />\n        </div>\n      );\n    }\n    return (\n      <div className=\"p-6 space-y-4\">\n        <p className=\"text-sm text-foreground-secondary\">{t('case.details.qrHint') || 'Upload an image (PNG/JPG/JPEG/SVG) containing a QR code. We will read it and store the link.'}</p>\n        <div className=\"flex items-center gap-3\">\n          <input\n            ref={qrInputRef}\n            type=\"file\"\n            accept={buildAcceptStringForQrImages()}\n            className=\"hidden\"\n            onChange={onQrSelected}\n          />\n          <button\n            type=\"button\"\n            onClick={onChooseQrClick}\n            className=\"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700\"\n          >\n            {t('common.chooseFile') || 'Choose file'}\n          </button>\n          <span className=\"text-sm text-foreground-secondary\">\n            {selectedQrFileName ? `${t('common.selectedFile') || 'Selected'}: ${selectedQrFileName}` : (t('common.noFileChosen') || 'No file chosen')}\n          </span>\n        </div>\n        <FormInputField<LinkForm>\n          label={'Description'}\n          name={'description' as Path<LinkForm>}\n          register={register}\n          required={true}\n          validation={{ required: 'Description is required', maxLength: { value: 256, message: 'Max 256 characters' } }}\n          error={errors.description?.message as string}\n        />\n      </div>\n    );\n  };\n\n  // Determine whether submit is allowed based on current mode\n  const canSubmit = (() => {\n    if (mode === 'file') {\n      return Boolean(selectedFileName);\n    }\n    if (mode === 'link') {\n      return Boolean(watchedDescription?.trim()) && Boolean(watchedLinkUrl) && validateUrl(watchedLinkUrl);\n    }\n    // mode === 'qr'\n    return Boolean(selectedQrFileName) && Boolean(watchedDescription?.trim());\n  })();\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} title={t('case.details.upload') || 'Upload'} size=\"lg\">\n      {/* Mode Selector */}\n      <div className=\"px-6 pt-4\">\n        <div className=\"inline-flex rounded-md border border-border-primary overflow-hidden w-full\">\n          {(['file','link','qr'] as UploadMode[]).map((m) => (\n            <button\n              key={m}\n              className={`px-4 py-2 text-sm w-full ${mode === m ? 'bg-primary-600 text-white' : 'bg-background-secondary text-foreground-primary'}`}\n              onClick={() => setMode(m)}\n              disabled={isSubmitting}\n            >\n              {m === 'file' ? (t('case.details.modeFile') || 'File') : m === 'link' ? (t('case.details.modeLink') || 'Link') : (t('case.details.modeQr') || 'QR')}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Diagnosis flag removed from UI; parent controls via prop */}\n\n      {renderStep()}\n\n      {error && <div className=\"px-6 pb-2 text-sm text-red-600\">{error}</div>}\n\n      <div className=\"px-6 pb-6 flex justify-end gap-3\">\n        <button onClick={onClose} className=\"px-4 py-2 rounded-md border border-border-primary\">\n          {t('common.cancel') || 'Cancel'}\n        </button>\n        <button onClick={handleSubmit} disabled={isSubmitting || !canSubmit} className=\"px-4 py-2 rounded-md bg-primary-600 text-white disabled:opacity-60\">\n          {isSubmitting ? (t('common.working') || 'Working...') : (t('common.submit') || 'Submit')}\n        </button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default UploadAttachmentWizard;\n\n\n","import React from 'react';\n\ninterface DividerProps {\n  marginClass?: string; // e.g., 'my-3', 'my-1'\n  colorVar?: string;    // CSS var name or any valid color value\n  className?: string;\n}\n\nconst Divider: React.FC<DividerProps> = ({ marginClass = 'my-3', colorVar = 'var(--border-secondary)', className = '' }) => {\n  return (\n    <div className={`${marginClass} flex justify-center ${className}`}>\n      <div className=\"h-[1px] w-full\" style={{ backgroundColor: colorVar }} />\n    </div>\n  );\n};\n\nexport default Divider;\n\n\n","import { UseFormRegister, RegisterOptions, FieldValues, Path } from 'react-hook-form';\nimport { ExclamationCircleIcon } from '@heroicons/react/24/outline';\n\ninterface FormInputFieldProps<T extends FieldValues> {\n  label: string;\n  name: Path<T>;\n  register: UseFormRegister<T>;\n  error?: string;\n  required?: boolean;\n  tooltip?: string;\n  validation?: RegisterOptions<T>;\n  className?: string;\n  type?: 'text' | 'email' | 'password' | 'number' | 'tel' | 'url' | 'date';\n  placeholder?: string;\n}\n\nexport const FormInputField = <T extends FieldValues>({\n  label,\n  name,\n  register,\n  error,\n  required = false,\n  tooltip,\n  validation = {},\n  className = '',\n  type = 'text',\n  placeholder\n}: FormInputFieldProps<T>) => {\n  return (\n    <div className={`mb-4 ${className}`}>\n      <div className=\"flex items-center gap-1\">\n        <label className=\"block text-base font-medium text-heading mb-2\">\n          {label}\n          {required && <span className=\"text-error-500 ml-1\">*</span>}\n        </label>\n        {tooltip && (\n          <div className=\"relative group\">\n            <span className=\"cursor-help text-foreground-tertiary hover:text-foreground-secondary\">\n              <ExclamationCircleIcon className=\"w-4 h-4\" />\n            </span>\n            <div className=\"absolute z-10 invisible group-hover:visible bg-neutral-900 text-white text-sm rounded p-2 bottom-full mb-1 w-48\">\n              {tooltip}\n            </div>\n          </div>\n        )}\n      </div>\n      <input\n        type={type}\n        placeholder={placeholder}\n        {...register(name, validation)}\n        className=\"input-field\"\n      />\n      {error && <p className=\"mt-2 text-sm text-error-600\">{error}</p>}\n    </div>\n  );\n};","import React, { useEffect } from 'react';\nimport { useLanguage } from '@/contexts/LanguageContext';\nimport { XMarkIcon } from '@heroicons/react/24/outline';\n\ninterface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  children: React.ReactNode;\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\n}\n\nconst Modal: React.FC<ModalProps> = ({ \n  isOpen, \n  onClose, \n  title, \n  children, \n  size = 'lg' \n}) => {\n  const { t } = useLanguage();\n\n  // Handle escape key press\n  useEffect(() => {\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleEscape);\n      // Prevent body scroll when modal is open\n      document.body.style.overflow = 'hidden';\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen, onClose]);\n\n  if (!isOpen) return null;\n\n  const sizeClasses = {\n    sm: 'max-w-md',\n    md: 'max-w-lg',\n    lg: 'max-w-2xl',\n    xl: 'max-w-7xl',\n    full: 'max-w-7xl'\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n      {/* Backdrop */}\n      <div \n        className=\"fixed inset-0 bg-black bg-opacity-50 transition-opacity\"\n        onClick={onClose}\n      />\n      \n      {/* Modal */}\n      <div className=\"flex min-h-full items-center justify-center p-4\">\n        <div \n          className={`relative bg-background-primary rounded-xl shadow-xl border border-border-primary w-full ${sizeClasses[size]} max-h-[90vh] overflow-hidden`}\n          onClick={(e) => e.stopPropagation()}\n        >\n          {/* Header */}\n          {title && (\n            <div className=\"flex items-center justify-between p-6 border-b border-border-primary\">\n              <h2 className=\"text-xl font-semibold text-foreground-primary\">\n                {title}\n              </h2>\n              <button\n                onClick={onClose}\n                className=\"text-foreground-tertiary hover:text-foreground-primary transition-colors duration-200 p-1 rounded-lg hover:bg-background-secondary\"\n                aria-label={t('common.close') || 'Close'}\n              >\n                <XMarkIcon className=\"w-6 h-6\" />\n              </button>\n            </div>\n          )}\n          \n          {/* Content */}\n          <div className=\"overflow-y-auto max-h-[calc(90vh-120px)]\">\n            {children}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Modal; ","// Frontend helper to map filenames/URLs to backend attachment type names\n\nexport type AttachmentTypeName =\n  | 'PNG'\n  | 'JPG'\n  | 'JPEG'\n  | 'DICOM'\n  | 'NIfTI-1 / NIfTI-2'\n  | 'Analyze 7.5'\n  | 'Aperio SVS'\n  | 'Zeiss CZI'\n  | 'Zeiss LSM'\n  | 'EDF / EDF+'\n  | 'WFDB (PhysioNet)'\n  | 'PDF'\n  | 'Link';\n\ninterface AttachmentTypeSpec {\n  name: AttachmentTypeName;\n  extensions: string[]; // lowercased, include dot (e.g., .pdf)\n  patterns?: RegExp[]; // for matching URLs/links\n}\n\nconst ATTACHMENT_TYPES: AttachmentTypeSpec[] = [\n  { name: 'PNG', extensions: ['.png'] },\n  { name: 'JPG', extensions: ['.jpg'] },\n  { name: 'JPEG', extensions: ['.jpeg'] },\n  { name: 'DICOM', extensions: ['.dcm', '.dicom', '.dic', '.ima', '.acr', '.dc3'] },\n  { name: 'NIfTI-1 / NIfTI-2', extensions: ['.nii', '.nii.gz'] },\n  { name: 'Analyze 7.5', extensions: ['.hdr', '.img'] },\n  { name: 'Aperio SVS', extensions: ['.svs'] },\n  { name: 'Zeiss CZI', extensions: ['.czi'] },\n  { name: 'Zeiss LSM', extensions: ['.lsm'] },\n  { name: 'EDF / EDF+', extensions: ['.edf'] },\n  { name: 'WFDB (PhysioNet)', extensions: ['.dat', '.hea'] },\n  { name: 'PDF', extensions: ['.pdf'] },\n  {\n    name: 'Link',\n    extensions: ['.url'],\n    patterns: [\n      /^https?:\\/\\/.+/i,\n      /^ftp:\\/\\/.+/i,\n      /^sftp:\\/\\/.+/i,\n      /^file:\\/\\/.+/i,\n      /^mailto:.+/i,\n      /^tel:.+/i,\n      /^www\\..+/i,\n      /^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\\.[a-zA-Z]{2,}/i,\n    ],\n  },\n];\n\n/**\n * Returns the attachment type name for a given filename or URL, or null if unsupported.\n */\nexport function getAttachmentTypeNameForFilename(input: string): AttachmentTypeName | null {\n  if (!input) return null;\n  const lower = input.toLowerCase();\n\n  // Special-case multi-part extensions like .nii.gz first\n  if (lower.endsWith('.nii.gz')) return 'NIfTI-1 / NIfTI-2';\n\n  // Exact extension match (with dot)\n  for (const type of ATTACHMENT_TYPES) {\n    for (const ext of type.extensions) {\n      if (lower.endsWith(ext)) {\n        return type.name;\n      }\n    }\n  }\n\n  // If input is just the extension (with or without dot)\n  const normalizedExt = lower.startsWith('.') ? lower : `.${lower}`;\n  for (const type of ATTACHMENT_TYPES) {\n    if (type.extensions.includes(normalizedExt)) {\n      return type.name;\n    }\n  }\n\n  // Pattern-based matching (links)\n  for (const type of ATTACHMENT_TYPES) {\n    if (type.patterns && type.patterns.some((re) => re.test(input))) {\n      return type.name;\n    }\n  }\n\n  return null;\n}\n\n/** Returns true if the given filename looks like a supported file upload (non-link). */\nexport function isSupportedFileByExtension(filename: string): boolean {\n  const type = getAttachmentTypeNameForFilename(filename);\n  return type !== null && type !== 'Link';\n}\n\n/** Builds an accept attribute string for HTML file inputs from all supported extensions. */\nexport function buildAcceptStringForAllFiles(): string {\n  // Include multi-part .nii.gz explicitly\n  const unique = new Set<string>(['.nii.gz']);\n  for (const spec of ATTACHMENT_TYPES) {\n    for (const ext of spec.extensions) {\n      unique.add(ext);\n    }\n  }\n  // Exclude Link's .url\n  unique.delete('.url');\n  return Array.from(unique).join(',');\n}\n\n/** Minimal accept string for QR-image uploads. */\nexport function buildAcceptStringForQrImages(): string {\n  return ['.png', '.jpg', '.jpeg', '.svg'].join(',');\n}\n\nexport const AttachmentTypeSpecs = ATTACHMENT_TYPES;\n\n\n","import Document, { Html, Head, Main, NextScript } from 'next/document';\n\nclass MyDocument extends Document {\n  render() {\n    return (\n      <Html lang=\"en\">\n        <Head>\n          <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n          <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"anonymous\" />\n          <link href=\"https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap\" rel=\"stylesheet\" />\n        </Head>\n        <body>\n          <Main />\n          <NextScript />\n        </body>\n      </Html>\n    );\n  }\n}\n\nexport default MyDocument;\n\n\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nObject.defineProperty(exports, \"RouteKind\", {\n    enumerable: true,\n    get: function() {\n        return RouteKind;\n    }\n});\nvar RouteKind = /*#__PURE__*/ function(RouteKind) {\n    /**\n   * `PAGES` represents all the React pages that are under `pages/`.\n   */ RouteKind[\"PAGES\"] = \"PAGES\";\n    /**\n   * `PAGES_API` represents all the API routes under `pages/api/`.\n   */ RouteKind[\"PAGES_API\"] = \"PAGES_API\";\n    /**\n   * `APP_PAGE` represents all the React pages that are under `app/` with the\n   * filename of `page.{j,t}s{,x}`.\n   */ RouteKind[\"APP_PAGE\"] = \"APP_PAGE\";\n    /**\n   * `APP_ROUTE` represents all the API routes and metadata routes that are under `app/` with the\n   * filename of `route.{j,t}s{,x}`.\n   */ RouteKind[\"APP_ROUTE\"] = \"APP_ROUTE\";\n    /**\n   * `IMAGE` represents all the images that are generated by `next/image`.\n   */ RouteKind[\"IMAGE\"] = \"IMAGE\";\n    return RouteKind;\n}({});\n\n//# sourceMappingURL=route-kind.js.map","import * as React from \"react\";\nfunction TrashIcon({\n  title,\n  titleId,\n  ...props\n}, svgRef) {\n  return /*#__PURE__*/React.createElement(\"svg\", Object.assign({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    fill: \"none\",\n    viewBox: \"0 0 24 24\",\n    strokeWidth: 1.5,\n    stroke: \"currentColor\",\n    \"aria-hidden\": \"true\",\n    \"data-slot\": \"icon\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n  }));\n}\nconst ForwardRef = /*#__PURE__*/ React.forwardRef(TrashIcon);\nexport default ForwardRef;"],"names":["items","onOpen","AttachmentList","openText","deleteText","showOpen","isOpenDisabled","workingText","div","className","length","map","item","index","label","metaLeft","metaRight","typeName","span","showDelete","button","onClick","id","disabled","onDelete","title","TrashIcon","p","isOpen","onClose","caseId","onUploaded","UploadAttachmentWizard","isDiagnosis","t","useLanguage","mode","setMode","useState","isSubmitting","setIsSubmitting","error","setError","fileInputRef","useRef","qrInputRef","selectedFileName","setSelectedFileName","selectedQrFileName","setSelectedQrFileName","http","HttpService","getInstance","register","getValues","reset","watch","formState","errors","useForm","watchedLinkUrl","watchedDescription","useEffect","current","value","linkUrl","description","validateUrl","test","URL","hostname","uploadFileFlow","file","getAttachmentTypeNameForFilename","name","createRes","createAttachment","originalName","type","is_diagnosis","presignedUrl","url","createdAttachmentId","attachmentId","signedContentType","urlObj","String","searchParams","get","undefined","putRes","fetch","method","headers","body","ok","text","deleteAttachment","idNum","Number","isNaN","uploadLinkFlow","urlValue","res","decodeQrFromImage","jsQR","jsQRModule","default","drawToCanvas","img","width","height","canvas","document","createElement","ctx","getContext","drawImage","imageData","getImageData","code","data","dataUrl","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsDataURL","image","Image","src","bitmap","createImageBitmap","handleSubmit","files","trim","desc","normalized","startsWith","decoded","Error","allowedFileExtensions","buildAcceptStringForAllFiles","split","allowedQrExtensions","buildAcceptStringForQrImages","validateExtension","filename","allowed","lower","toLowerCase","some","ext","endsWith","canSubmit","Boolean","Modal","size","m","input","ref","accept","onChange","onFileSelected","e","target","currentTarget","onChooseFileClick","click","FormInputField","validation","required","validate","message","maxLength","onQrSelected","onChooseQrClick","marginClass","Divider","colorVar","style","backgroundColor","tooltip","placeholder","ExclamationCircleIcon","children","handleEscape","event","key","addEventListener","overflow","removeEventListener","sizeClasses","sm","md","lg","xl","full","stopPropagation","h2","aria-label","XMarkIcon","ATTACHMENT_TYPES","extensions","patterns","normalizedExt","includes","re","unique","Set","spec","add","delete","Array","from","join","MyDocument","Document","render","Html","lang","Head","link","rel","href","crossOrigin","Main","NextScript","React","ForwardRef","titleId","props","svgRef","Object","assign","xmlns","fill","viewBox","strokeWidth","stroke","strokeLinecap","strokeLinejoin","d"],"sourceRoot":""}