"use strict";exports.id=625,exports.ids=[625],exports.modules={671:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1833:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(8732);r(2015);var n=r(430);let a=({items:e,onOpen:t,onDelete:r,openText:a="Open",deleteText:s="Delete",showOpen:l=!1,isOpenDisabled:o,workingText:d="Working..."})=>(0,i.jsx)("div",{className:"space-y-3",children:e.length>0?e.map((e,c)=>(0,i.jsxs)("div",{className:"bg-neutral-50 rounded-md p-4 flex items-center justify-between border border-border-primary",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("div",{className:"font-medium text-foreground-primary",children:e.label||`Attachment ${c+1}`}),(e.metaLeft||e.metaRight||e.typeName)&&(0,i.jsxs)("div",{className:"text-sm text-foreground-tertiary flex gap-4",children:[e.typeName?(0,i.jsx)("span",{children:e.typeName}):null,e.metaLeft?(0,i.jsx)("span",{children:e.metaLeft}):null,e.metaRight?(0,i.jsx)("span",{children:e.metaRight}):null]})]}),(l||e.showDelete)&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[l&&t&&(0,i.jsx)("button",{onClick:()=>t(e.id),disabled:!!o&&o(e),className:"bg-primary-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-primary-700 transition-colors disabled:opacity-60",children:o&&o(e)?d:"function"==typeof a?a(e):a}),e.showDelete&&r&&(0,i.jsx)("button",{onClick:()=>r(e.id),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 transition-colors",title:s,children:(0,i.jsx)(n.A,{className:"w-4 h-4"})})]})]},`${e.id}-${c}`)):(0,i.jsx)("div",{className:"text-center py-8 text-foreground-tertiary",children:(0,i.jsx)("p",{className:"text-sm",children:"No attachments yet"})})})},2390:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{A:()=>p});var n=r(8732),a=r(2015),s=r(4563),l=r(1308),o=r(8335),d=r(7449),c=r(6884),m=r(5948),u=e([o,c]);[o,c]=u.then?(await u)():u;let p=({isOpen:e,onClose:t,caseId:i,onUploaded:u,isDiagnosis:p=!1})=>{let{t:h}=(0,l.o)(),[x,f]=(0,a.useState)("file"),[g,y]=(0,a.useState)(!1),[w,b]=(0,a.useState)(null),v=(0,a.useRef)(null),j=(0,a.useRef)(null),[N,k]=(0,a.useState)(""),[P,A]=(0,a.useState)(""),C=o.k.getInstance(),{register:E,getValues:L,reset:I,watch:S,formState:{errors:R}}=(0,c.useForm)(),T=S("linkUrl"),F=S("description");(0,a.useEffect)(()=>{if(e){k(""),A(""),b(null);try{v.current&&(v.current.value=""),j.current&&(j.current.value="")}catch{}I({linkUrl:"",description:""})}},[e,I]);let D=e=>{try{if(/^(mailto:|tel:)/i.test(e)||/^www\./i.test(e))return!0;return!!new URL(/^https?:\/\//i.test(e)?e:`https://${e}`).hostname}catch{return!1}},$=async e=>{let t=(0,d.XZ)(e.name),r=await C.createAttachment({caseId:i,originalName:e.name,type:t?{name:t}:null,is_diagnosis:p}),n=r?.url,a=r?.attachmentId;if(!n)throw Error("Upload URL not returned");let s=new URL(String(n)).searchParams.get("Content-Type")||void 0,l=await fetch(n,{method:"PUT",headers:s?{"Content-Type":s}:e.type?{"Content-Type":e.type}:{},body:e});if(!l.ok){let e=await l.text();try{a&&"number"==typeof i&&await C.deleteAttachment({attachmentId:String(a),caseId:i})}catch{}throw Error(e||"Failed to upload to storage")}if(a){let r="number"==typeof a?a:Number(a);Number.isNaN(r)||u?.(r,e.name,t||void 0)}},G=async(e,t)=>{let r=await C.createAttachment({caseId:i,url:e,description:t,type:{name:"Link"},is_diagnosis:p});r&&"number"==typeof r.attachmentId&&u?.(r.attachmentId,t||e,"Link")},U=async e=>{let t=(await Promise.resolve().then(r.t.bind(r,2268,23))).default,i=async e=>{let r=e.width??e.width??0,i=e.height??e.height??0,n=document.createElement("canvas");n.width=r,n.height=i;let a=n.getContext("2d");if(!a)return null;a.drawImage(e,0,0);let s=a.getImageData(0,0,n.width,n.height),l=t(s.data,s.width,s.height);return l?.data||null};if(/\.svg$/i.test(e.name)||"image/svg+xml"===e.type){let t=await new Promise((t,r)=>{let i=new FileReader;i.onload=()=>t(String(i.result)),i.onerror=r,i.readAsDataURL(e)}),r=await new Promise((e,r)=>{let i=new Image;i.onload=()=>e(i),i.onerror=r,i.src=t});return i(r)}let n=await createImageBitmap(e);return i(n)},q=async()=>{try{if(b(null),y(!0),"file"===x){let e=v.current?.files?.[0];if(!e)throw Error("Please select a file");await $(e)}else if("link"===x){let e=(L("linkUrl")||"").trim();if(!D(e))throw Error("Please enter a valid link");let t=(L("description")||"").trim();if(!t)throw Error("Please enter a description");let r=/^(https?:\/\/|mailto:|tel:)/i.test(e)?e:(e.startsWith("www."),`https://${e}`);await G(r,t)}else if("qr"===x){let e=j.current?.files?.[0];if(!e)throw Error("Please select an image or PDF with QR");if(/\.pdf$/i.test(e.name))throw Error("QR decoding from PDF is not supported in-browser. Please upload an image containing the QR code.");let t=await U(e);if(!t)throw Error("Could not read a QR code from the image");if(!D(t))throw Error("QR code does not contain a valid link");let r=(L("description")||"").trim();if(!r)throw Error("Please enter a description");let i=/^(https?:\/\/|mailto:|tel:)/i.test(t)?t:(t.startsWith("www."),`https://${t}`);await G(i,r)}t()}finally{y(!1)}},z=(0,d.nC)().split(","),Q=(0,d.QT)().split(","),W=(e,t)=>{let r=e.toLowerCase();return t.some(e=>r.endsWith(e))},O="file"===x?!!N:"link"===x?!!F?.trim()&&!!T&&D(T):!!P&&!!F?.trim();return(0,n.jsxs)(s.A,{isOpen:e,onClose:t,title:h("case.details.upload")||"Upload",size:"lg",children:[(0,n.jsx)("div",{className:"px-6 pt-4",children:(0,n.jsx)("div",{className:"inline-flex rounded-md border border-border-primary overflow-hidden w-full",children:["file","link","qr"].map(e=>(0,n.jsx)("button",{className:`px-4 py-2 text-sm w-full ${x===e?"bg-primary-600 text-white":"bg-background-secondary text-foreground-primary"}`,onClick:()=>f(e),disabled:g,children:"file"===e?h("case.details.modeFile")||"File":"link"===e?h("case.details.modeLink")||"Link":h("case.details.modeQr")||"QR"},e))})}),"file"===x?(0,n.jsxs)("div",{className:"p-6 space-y-4",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-secondary",children:h("case.details.uploadFileHint")||"Upload PNG, JPG, JPEG, PDF, DICOM, NIfTI, etc."}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{ref:v,type:"file",accept:(0,d.nC)(),className:"hidden",onChange:e=>{let t=e.target.files?.[0];if(t){if(!W(t.name,z)){k(""),e.currentTarget.value="",b(h("validation.fileTypeNotAllowed")||"This file type is not allowed");return}b(null),k(t.name)}}}),(0,n.jsx)("button",{type:"button",onClick:()=>v.current?.click(),className:"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700",children:h("common.chooseFile")||"Choose file"}),(0,n.jsx)("span",{className:"text-sm text-foreground-secondary",children:N?`${h("common.selectedFile")||"Selected"}: ${N}`:h("common.noFileChosen")||"No file chosen"})]})]}):"link"===x?(0,n.jsxs)("div",{className:"p-6 space-y-4",children:[(0,n.jsx)(m.l,{label:h("case.details.modeLink")||"Link",name:"linkUrl",register:E,type:"url",validation:{required:"Link is required",validate:e=>D(e)||"Please enter a valid link"},error:R.linkUrl?.message}),(0,n.jsx)("p",{className:"text-xs text-foreground-tertiary",children:h("case.details.linkHint")||"Accepts http(s), mailto:, tel:, or domain names. Will be validated."}),(0,n.jsx)(m.l,{label:"Description",name:"description",register:E,required:!0,validation:{required:"Description is required",maxLength:{value:256,message:"Max 256 characters"}},error:R.description?.message})]}):(0,n.jsxs)("div",{className:"p-6 space-y-4",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-secondary",children:h("case.details.qrHint")||"Upload an image (PNG/JPG/JPEG/SVG) containing a QR code. We will read it and store the link."}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{ref:j,type:"file",accept:(0,d.QT)(),className:"hidden",onChange:e=>{let t=e.target.files?.[0];if(t){if(!W(t.name,Q)){A(""),e.currentTarget.value="",b(h("validation.fileTypeNotAllowed")||"This file type is not allowed");return}if(/\.pdf$/i.test(t.name)){A(""),e.currentTarget.value="",b(h("case.details.qrPdfNotSupported")||"QR decoding from PDF is not supported");return}b(null),A(t.name)}}}),(0,n.jsx)("button",{type:"button",onClick:()=>j.current?.click(),className:"px-4 py-2 rounded-md bg-primary-600 text-white hover:bg-primary-700",children:h("common.chooseFile")||"Choose file"}),(0,n.jsx)("span",{className:"text-sm text-foreground-secondary",children:P?`${h("common.selectedFile")||"Selected"}: ${P}`:h("common.noFileChosen")||"No file chosen"})]}),(0,n.jsx)(m.l,{label:"Description",name:"description",register:E,required:!0,validation:{required:"Description is required",maxLength:{value:256,message:"Max 256 characters"}},error:R.description?.message})]}),w&&(0,n.jsx)("div",{className:"px-6 pb-2 text-sm text-red-600",children:w}),(0,n.jsxs)("div",{className:"px-6 pb-6 flex justify-end gap-3",children:[(0,n.jsx)("button",{onClick:t,className:"px-4 py-2 rounded-md border border-border-primary",children:h("common.cancel")||"Cancel"}),(0,n.jsx)("button",{onClick:q,disabled:g||!O,className:"px-4 py-2 rounded-md bg-primary-600 text-white disabled:opacity-60",children:g?h("common.working")||"Working...":h("common.submit")||"Submit"})]})]})};i()}catch(e){i(e)}})},8815:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(8732);r(2015);let n=({marginClass:e="my-3",colorVar:t="var(--border-secondary)",className:r=""})=>(0,i.jsx)("div",{className:`${e} flex justify-center ${r}`,children:(0,i.jsx)("div",{className:"h-[1px] w-full",style:{backgroundColor:t}})})},5948:(e,t,r)=>{r.d(t,{l:()=>a});var i=r(8732),n=r(8641);let a=({label:e,name:t,register:r,error:a,required:s=!1,tooltip:l,validation:o={},className:d="",type:c="text",placeholder:m})=>(0,i.jsxs)("div",{className:`mb-4 ${d}`,children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsxs)("label",{className:"block text-base font-medium text-heading mb-2",children:[e,s&&(0,i.jsx)("span",{className:"text-error-500 ml-1",children:"*"})]}),l&&(0,i.jsxs)("div",{className:"relative group",children:[(0,i.jsx)("span",{className:"cursor-help text-foreground-tertiary hover:text-foreground-secondary",children:(0,i.jsx)(n.A,{className:"w-4 h-4"})}),(0,i.jsx)("div",{className:"absolute z-10 invisible group-hover:visible bg-neutral-900 text-white text-sm rounded p-2 bottom-full mb-1 w-48",children:l})]})]}),(0,i.jsx)("input",{type:c,placeholder:m,...r(t,o),className:"input-field"}),a&&(0,i.jsx)("p",{className:"mt-2 text-sm text-error-600",children:a})]})},4563:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(8732),n=r(2015),a=r(1308),s=r(565);let l=({isOpen:e,onClose:t,title:r,children:l,size:o="lg"})=>{let{t:d}=(0,a.o)();return((0,n.useEffect)(()=>{let r=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow="unset"}},[e,t]),e)?(0,i.jsxs)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),(0,i.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,i.jsxs)("div",{className:`relative bg-background-primary rounded-xl shadow-xl border border-border-primary w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-7xl",full:"max-w-7xl"}[o]} max-h-[90vh] overflow-hidden`,onClick:e=>e.stopPropagation(),children:[r&&(0,i.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-primary",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-foreground-primary",children:r}),(0,i.jsx)("button",{onClick:t,className:"text-foreground-tertiary hover:text-foreground-primary transition-colors duration-200 p-1 rounded-lg hover:bg-background-secondary","aria-label":d("common.close")||"Close",children:(0,i.jsx)(s.A,{className:"w-6 h-6"})})]}),(0,i.jsx)("div",{className:"overflow-y-auto max-h-[calc(90vh-120px)]",children:l})]})})]}):null}},7449:(e,t,r)=>{r.d(t,{QT:()=>s,XZ:()=>n,nC:()=>a});let i=[{name:"PNG",extensions:[".png"]},{name:"JPG",extensions:[".jpg"]},{name:"JPEG",extensions:[".jpeg"]},{name:"DICOM",extensions:[".dcm",".dicom",".dic",".ima",".acr",".dc3"]},{name:"NIfTI-1 / NIfTI-2",extensions:[".nii",".nii.gz"]},{name:"Analyze 7.5",extensions:[".hdr",".img"]},{name:"Aperio SVS",extensions:[".svs"]},{name:"Zeiss CZI",extensions:[".czi"]},{name:"Zeiss LSM",extensions:[".lsm"]},{name:"EDF / EDF+",extensions:[".edf"]},{name:"WFDB (PhysioNet)",extensions:[".dat",".hea"]},{name:"PDF",extensions:[".pdf"]},{name:"Link",extensions:[".url"],patterns:[/^https?:\/\/.+/i,/^ftp:\/\/.+/i,/^sftp:\/\/.+/i,/^file:\/\/.+/i,/^mailto:.+/i,/^tel:.+/i,/^www\..+/i,/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}/i]}];function n(e){if(!e)return null;let t=e.toLowerCase();if(t.endsWith(".nii.gz"))return"NIfTI-1 / NIfTI-2";for(let e of i)for(let r of e.extensions)if(t.endsWith(r))return e.name;let r=t.startsWith(".")?t:`.${t}`;for(let e of i)if(e.extensions.includes(r))return e.name;for(let t of i)if(t.patterns&&t.patterns.some(t=>t.test(e)))return t.name;return null}function a(){let e=new Set([".nii.gz"]);for(let t of i)for(let r of t.extensions)e.add(r);return e.delete(".url"),Array.from(e).join(",")}function s(){return".png,.jpg,.jpeg,.svg"}},3212:(e,t,r)=>{r.r(t),r.d(t,{default:()=>l});var i=r(8732),n=r(883),a=r.n(n);class s extends a(){render(){return(0,i.jsxs)(n.Html,{lang:"en",children:[(0,i.jsxs)(n.Head,{children:[(0,i.jsx)("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),(0,i.jsx)("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),(0,i.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap",rel:"stylesheet"})]}),(0,i.jsxs)("body",{children:[(0,i.jsx)(n.Main,{}),(0,i.jsx)(n.NextScript,{})]})]})}}let l=s},9455:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},430:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(2015);let n=i.forwardRef(function({title:e,titleId:t,...r},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))})}};
//# sourceMappingURL=625.js.map